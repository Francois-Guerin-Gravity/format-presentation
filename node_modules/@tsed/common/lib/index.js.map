{"version":3,"file":"index.js","sources":["../src/config/services/PlatformConfiguration.ts","../src/middlewares/bindEndpointMiddleware.ts","../src/middlewares/PlatformLogMiddleware.ts","../src/services/FakeRawDriver.ts","../src/domain/AnyToPromiseWithCtx.ts","../src/interfaces/HandlerType.ts","../src/domain/HandlerMetadata.ts","../src/domain/EndpointMetadata.ts","../src/utils/createHandlerMetadata.ts","../src/utils/setResponseHeaders.ts","../src/services/ConverterService.ts","../src/services/PlatformHandler.ts","../src/services/PlatformRouter.ts","../src/services/PlatformApplication.ts","../src/middlewares/PlatformMulterMiddleware.ts","../src/middlewares/GlobalAcceptMimesMiddleware.ts","../src/middlewares/PlatformAcceptMimesMiddleware.ts","../src/middlewares/AcceptMimesMiddleware.ts","../src/utils/useCtxHandler.ts","../src/builder/PlatformControllerBuilder.ts","../src/services/PlatformRequest.ts","../src/services/PlatformResponse.ts","../src/domain/PlatformContext.ts","../src/domain/PlatformRouteDetails.ts","../src/constants/routerOptions.ts","../src/domain/ControllerProvider.ts","../src/domain/PropertyMetadata.ts","../src/utils/getControllerPath.ts","../src/services/Platform.ts","../src/PlatformModule.ts","../src/utils/createInjector.ts","../src/utils/createPlatformApplication.ts","../src/decorators/httpServer.ts","../src/utils/listenServer.ts","../src/utils/createHttpServer.ts","../src/decorators/httpsServer.ts","../src/utils/createHttpsServer.ts","../src/utils/loadInjector.ts","../src/utils/printRoutes.ts","../src/utils/createContext.ts","../src/builder/PlatformBuilder.ts","../src/decorators/multer/multerOptions.ts","../src/decorators/multer/multerFileSize.ts","../src/decorators/multer/multipartFile.ts","../src/decorators/method/route.ts","../src/decorators/method/endpointFn.ts","../src/decorators/method/acceptMime.ts","../src/decorators/class/controller.ts","../src/decorators/params/responseData.ts","../src/decorators/params/response.ts","../src/decorators/params/request.ts","../src/decorators/params/next.ts","../src/decorators/params/error.ts","../src/decorators/params/endpointInfo.ts","../src/utils/mapReturnedResponse.ts","../src/services/PlatformTest.ts","../src/registries/ControllerRegistry.ts"],"sourcesContent":["import {Env} from \"@tsed/core\";\nimport {DIConfiguration, Injectable, ProviderScope, ProviderType} from \"@tsed/di\";\nimport {$log} from \"@tsed/logger\";\nimport Https from \"https\";\nimport {EndpointDirectoriesSettings, PlatformLoggerSettings} from \"../interfaces\";\nimport {ConverterSettings} from \"../interfaces/ConverterSettings\";\n\nconst rootDir = process.cwd();\n\n/**\n * `PlatformConfiguration` contains all information about your Server configuration.\n */\n@Injectable({\n  scope: ProviderScope.SINGLETON,\n  global: true\n})\nexport class PlatformConfiguration extends DIConfiguration {\n  constructor() {\n    super({\n      rootDir,\n      env: (process.env.NODE_ENV as Env) || Env.DEV,\n      httpPort: 8080,\n      httpsPort: false,\n      scopes: {\n        [ProviderType.CONTROLLER]: ProviderScope.SINGLETON\n      },\n      logger: {\n        debug: false,\n        level: \"info\",\n        logRequest: true,\n        jsonIndentation: process.env.NODE_ENV === Env.PROD ? 0 : 2\n      },\n      errors: {\n        headerName: \"errors\"\n      },\n      mount: {\n        \"/rest\": \"${rootDir}/controllers/**/*.ts\"\n      },\n      exclude: [\"**/*.spec.ts\", \"**/*.spec.js\"],\n      componentsScan: [\"${rootDir}/mvc/**/*.ts\", \"${rootDir}/services/**/*.ts\", \"${rootDir}/middlewares/**/*.ts\"]\n    });\n  }\n\n  get version() {\n    return this.getRaw(\"version\");\n  }\n\n  set version(v: string) {\n    this.setRaw(\"version\", v);\n  }\n\n  get rootDir() {\n    return this.getRaw(\"rootDir\");\n  }\n\n  set rootDir(value: string) {\n    this.setRaw(\"rootDir\", value);\n  }\n\n  get port(): string | number | false {\n    return this.httpPort;\n  }\n\n  set port(value: string | number | false) {\n    this.httpPort = value;\n  }\n\n  get httpsOptions(): Https.ServerOptions {\n    return this.getRaw(\"httpsOptions\");\n  }\n\n  set httpsOptions(value: Https.ServerOptions) {\n    this.setRaw(\"httpsOptions\", value);\n  }\n\n  get httpPort(): string | number | false {\n    return this.getRaw(\"httpPort\");\n  }\n\n  set httpPort(value: string | number | false) {\n    this.setRaw(\"httpPort\", value);\n  }\n\n  get httpsPort(): string | number | false {\n    return this.getRaw(\"httpsPort\");\n  }\n\n  set httpsPort(value: string | number | false) {\n    this.setRaw(\"httpsPort\", value);\n  }\n\n  get env(): Env {\n    return this.getRaw(\"env\");\n  }\n\n  set env(value: Env) {\n    this.setRaw(\"env\", value);\n  }\n\n  get mount(): EndpointDirectoriesSettings {\n    return this.get(\"mount\");\n  }\n\n  set mount(value: EndpointDirectoriesSettings) {\n    this.setRaw(\"mount\", value);\n  }\n\n  get componentsScan(): string[] {\n    return this.resolve(this.getRaw(\"componentsScan\"));\n  }\n\n  set componentsScan(value: string[]) {\n    this.setRaw(\"componentsScan\", value);\n  }\n\n  get statics(): EndpointDirectoriesSettings {\n    return this.getRaw(\"statics\") || this.getRaw(\"serveStatic\") || {};\n  }\n\n  set statics(value: EndpointDirectoriesSettings) {\n    this.setRaw(\"statics\", value);\n  }\n\n  get acceptMimes(): string[] {\n    return this.getRaw(\"acceptMimes\");\n  }\n\n  set acceptMimes(value: string[]) {\n    this.setRaw(\"acceptMimes\", value || []);\n  }\n\n  get debug(): boolean {\n    return this.logger.level === \"debug\";\n  }\n\n  set debug(debug: boolean) {\n    this.logger = {...this.logger, level: debug ? \"debug\" : \"info\"};\n  }\n\n  get converter(): Partial<ConverterSettings> {\n    return this.get(\"converter\") || {};\n  }\n\n  set converter(options: Partial<ConverterSettings>) {\n    this.setRaw(\"converter\", options);\n  }\n\n  get logger(): Partial<PlatformLoggerSettings> {\n    return this.get(\"logger\");\n  }\n\n  set logger(value: Partial<PlatformLoggerSettings>) {\n    const logger = {...this.logger, ...value};\n    logger.debug = logger.level === \"debug\";\n\n    this.setRaw(\"logger\", logger);\n    this.setRaw(\"debug\", logger.debug);\n\n    if (logger.format) {\n      $log.appenders.set(\"stdout\", {\n        type: \"stdout\",\n        levels: [\"info\", \"debug\"],\n        layout: {\n          type: \"pattern\",\n          pattern: logger.format\n        }\n      });\n\n      $log.appenders.set(\"stderr\", {\n        levels: [\"trace\", \"fatal\", \"error\", \"warn\"],\n        type: \"stderr\",\n        layout: {\n          type: \"pattern\",\n          pattern: logger.format\n        }\n      });\n    }\n  }\n\n  get exclude() {\n    return this.get(\"exclude\");\n  }\n\n  set exclude(exclude: string[]) {\n    this.setRaw(\"exclude\", exclude);\n  }\n\n  /**\n   *\n   * @param addressPort\n   * @returns {{address: string, port: number}}\n   */\n  private static buildAddressAndPort(addressPort: string | number): {address: string; port: number} {\n    let address = \"0.0.0.0\";\n    let port = addressPort;\n\n    if (typeof addressPort === \"string\" && addressPort.indexOf(\":\") > -1) {\n      [address, port] = addressPort.split(\":\");\n      port = +port;\n    }\n\n    return {address, port: port as number};\n  }\n\n  /**\n   *\n   * @returns {string|number}\n   */\n  getHttpPort(): {address: string; port: number} {\n    return PlatformConfiguration.buildAddressAndPort(this.getRaw(\"httpPort\"));\n  }\n\n  /**\n   *\n   * @param settings\n   */\n  setHttpPort(settings: {address: string; port: number}) {\n    this.setRaw(\"httpPort\", `${settings.address}:${settings.port}`);\n  }\n\n  /**\n   *\n   * @returns {string|number}\n   */\n  getHttpsPort(): {address: string; port: number} {\n    return PlatformConfiguration.buildAddressAndPort(this.getRaw(\"httpsPort\"));\n  }\n\n  /**\n   *\n   * @param settings\n   */\n  setHttpsPort(settings: {address: string; port: number}) {\n    this.setRaw(\"httpsPort\", `${settings.address}:${settings.port}`);\n  }\n}\n","import type {EndpointMetadata, PlatformContext} from \"../domain\";\n\n/**\n * @ignore\n */\nexport function bindEndpointMiddleware(endpoint: EndpointMetadata) {\n  return (ctx: PlatformContext) => {\n    ctx.endpoint = endpoint;\n  };\n}\n","import {InjectorService} from \"@tsed/di\";\nimport {Middleware, MiddlewareMethods} from \"@tsed/platform-middlewares\";\nimport {Context} from \"@tsed/platform-params\";\nimport {PlatformLoggerSettings} from \"../config/interfaces/PlatformLoggerSettings\";\nimport {OnResponse} from \"../interfaces/OnResponse\";\n\n/**\n * @middleware\n * @platform\n */\n@Middleware()\nexport class PlatformLogMiddleware implements MiddlewareMethods, OnResponse {\n  protected static DEFAULT_FIELDS = [\"reqId\", \"method\", \"url\", \"duration\"];\n\n  $onResponse: any;\n\n  protected settings: PlatformLoggerSettings;\n\n  // tslint:disable-next-line: no-unused-variable\n  constructor(injector: InjectorService) {\n    this.settings = injector.settings.logger || {};\n    this.settings.requestFields = this.settings.requestFields || PlatformLogMiddleware.DEFAULT_FIELDS;\n\n    if (this.settings.level !== \"off\") {\n      this.$onResponse = this.onLogEnd.bind(this);\n    }\n  }\n\n  /**\n   * Handle the request.\n   */\n  public use(@Context() ctx: Context): void {\n    this.configureRequest(ctx);\n    this.onLogStart(ctx);\n  }\n\n  /**\n   * The separate onLogStart() function will allow developer to overwrite the initial request log.\n   * @param ctx\n   */\n  protected onLogStart(ctx: Context) {\n    const {debug, logRequest, logStart} = this.settings;\n\n    if (logStart !== false) {\n      if (debug) {\n        ctx.logger.debug({\n          event: \"request.start\"\n        });\n      } else if (logRequest) {\n        ctx.logger.info({\n          event: \"request.start\"\n        });\n      }\n    }\n  }\n\n  /**\n   * Called when the `$onResponse` is called by Ts.ED (through Express.end).\n   */\n  protected onLogEnd(ctx: Context) {\n    const {debug, logRequest, logEnd} = this.settings;\n\n    if (logEnd !== false) {\n      if (debug) {\n        ctx.logger.debug({\n          event: \"request.end\",\n          status: ctx.response.statusCode,\n          data: ctx.data\n        });\n      } else if (logRequest) {\n        ctx.logger.info({\n          event: \"request.end\",\n          status: ctx.response.statusCode\n        });\n      }\n    }\n\n    ctx.logger.flush();\n  }\n\n  /**\n   * Attach all information that will be necessary to log the request. Attach a new `request.log` object.\n   */\n  protected configureRequest(ctx: Context) {\n    ctx.logger.minimalRequestPicker = (obj: any) => ({...this.minimalRequestPicker(ctx), ...obj});\n    ctx.logger.completeRequestPicker = (obj: any) => ({...this.requestToObject(ctx), ...obj});\n  }\n\n  /**\n   * Return complete request info.\n   * @returns {Object}\n   * @param ctx\n   */\n  protected requestToObject(ctx: Context): any {\n    const {request} = ctx;\n\n    return {\n      method: request.method,\n      url: request.url,\n      headers: request.headers,\n      body: request.body,\n      query: request.query,\n      params: request.params\n    };\n  }\n\n  /**\n   * Return a filtered request from global configuration.\n   * @returns {Object}\n   * @param ctx\n   */\n  protected minimalRequestPicker(ctx: Context): any {\n    const {requestFields} = this.settings;\n    const info = this.requestToObject(ctx);\n\n    return requestFields!.reduce((acc: any, key: string) => {\n      acc[key] = info[key];\n\n      return acc;\n    }, {});\n  }\n}\n","/**\n * @ignore\n */\nexport const createFakeRawDriver = () => {\n  // istanbul ignore next\n  function FakeRawDriver() {}\n\n  // istanbul ignore next\n  function use() {\n    return this;\n  }\n\n  FakeRawDriver.use = use;\n  FakeRawDriver.all = use;\n  FakeRawDriver.get = use;\n  FakeRawDriver.patch = use;\n  FakeRawDriver.post = use;\n  FakeRawDriver.put = use;\n  FakeRawDriver.head = use;\n  FakeRawDriver.delete = use;\n  FakeRawDriver.options = use;\n\n  return FakeRawDriver;\n};\n","import {AnyPromiseResult, AnyToPromise, AnyToPromiseStatus} from \"@tsed/core\";\nimport {PlatformContext} from \"./PlatformContext\";\n\n/**\n * @ignore\n */\nexport interface HandlerContextOptions {\n  $ctx: PlatformContext;\n  err?: any;\n}\n\nexport class AnyToPromiseWithCtx extends AnyToPromise {\n  public $ctx: PlatformContext;\n  public err: unknown;\n\n  constructor({$ctx, err}: HandlerContextOptions) {\n    super();\n    this.$ctx = $ctx;\n    this.err = err;\n  }\n\n  isDone(): boolean {\n    const {$ctx} = this;\n\n    if (!$ctx?.isDone()) {\n      if ($ctx?.request.isAborted() || $ctx?.response.isDone()) {\n        this.destroy();\n\n        if (this.status === AnyToPromiseStatus.PENDING) {\n          this.status = AnyToPromiseStatus.RESOLVED;\n        }\n      }\n    }\n\n    return super.isDone();\n  }\n\n  async call(cb: Function): Promise<AnyPromiseResult<any>> {\n    return super.call(() => cb(this));\n  }\n\n  destroy() {\n    // @ts-ignore\n    delete this.$ctx;\n  }\n\n  isCanceledResponse(process: any) {\n    return process === this.$ctx.getResponse();\n  }\n}\n","/**\n * @ignore\n */\nexport enum HandlerType {\n  CUSTOM = \"custom\",\n  ENDPOINT = \"endpoint\",\n  MIDDLEWARE = \"middleware\",\n  ERR_MIDDLEWARE = \"err:middleware\",\n  CTX_FN = \"context\",\n  RAW_FN = \"raw:middleware\",\n  RAW_ERR_FN = \"raw:err:middleware\"\n}\n","import {nameOf, Type} from \"@tsed/core\";\nimport {ProviderScope} from \"@tsed/di\";\nimport {ParamMetadata, ParamTypes} from \"@tsed/platform-params\";\nimport {JsonEntityStore} from \"@tsed/schema\";\nimport {HandlerType} from \"../interfaces/HandlerType\";\nimport {PlatformRouteOptions, PlatformRouteWithoutHandlers} from \"../interfaces/PlatformRouteOptions\";\n\nexport interface HandlerMetadataOptions {\n  target: (Type<any> | Function) & {type?: HandlerType};\n  routeOptions?: PlatformRouteWithoutHandlers;\n  token?: Type<any>;\n  propertyKey?: string | symbol;\n  scope?: ProviderScope;\n  type?: HandlerType;\n}\n\nexport class HandlerMetadata {\n  readonly target: any;\n  readonly token: Type<any>;\n  readonly propertyKey: string | symbol;\n  readonly injectable: boolean = false;\n  readonly type: HandlerType = HandlerType.RAW_FN;\n  readonly hasNextFunction: boolean = false;\n  readonly routeOptions: Partial<PlatformRouteOptions>;\n  readonly scope: ProviderScope;\n\n  handler: any;\n\n  constructor(options: HandlerMetadataOptions) {\n    const {target, token, propertyKey, type, scope, routeOptions} = options;\n\n    this.type = type || target.type || HandlerType.RAW_FN;\n    this.scope = scope || ProviderScope.SINGLETON;\n    this.routeOptions = routeOptions || {};\n    const handler = propertyKey ? target.prototype[propertyKey] : target;\n\n    if (propertyKey) {\n      this.target = target;\n      this.token = token!;\n      this.propertyKey = propertyKey;\n      this.hasNextFunction = this.hasParamType(ParamTypes.NEXT_FN);\n\n      if (this.hasParamType(ParamTypes.ERR)) {\n        this.type = HandlerType.ERR_MIDDLEWARE;\n      }\n\n      this.injectable = ParamMetadata.getParams(target as any, propertyKey).length > 0;\n    } else {\n      this.handler = handler;\n    }\n\n    if (!this.injectable) {\n      if (handler.length === 4) {\n        this.type = HandlerType.RAW_ERR_FN;\n      }\n      this.hasNextFunction = handler.length >= 3;\n    }\n  }\n\n  get hasErrorParam() {\n    return this.type === HandlerType.ERR_MIDDLEWARE || this.type === HandlerType.RAW_ERR_FN;\n  }\n\n  public getParams() {\n    return ParamMetadata.getParams(this.target, this.propertyKey) || [];\n  }\n\n  public hasParamType(paramType: any): boolean {\n    return this.getParams().findIndex((p) => p.paramType === paramType) > -1;\n  }\n\n  public isFinal() {\n    return this.routeOptions?.isFinal || false;\n  }\n\n  toString() {\n    return [this.target && nameOf(this.target), this.propertyKey].filter(Boolean).join(\".\");\n  }\n}\n","import {classOf, DecoratorTypes, deepMerge, descriptorOf, Enumerable, isFunction, nameOf, prototypeOf, Store, Type} from \"@tsed/core\";\nimport {ParamMetadata} from \"@tsed/platform-params\";\nimport {getOperationsStores, JsonEntityComponent, JsonEntityStore, JsonEntityStoreOptions, JsonOperation} from \"@tsed/schema\";\n\nexport interface EndpointConstructorOptions extends JsonEntityStoreOptions {\n  beforeMiddlewares?: Function[];\n  middlewares?: Function[];\n  afterMiddlewares?: Function[];\n}\n\nexport interface EndpointViewOptions {\n  path: string;\n  options: any;\n}\n\nexport interface EndpointRedirectOptions {\n  status: number | undefined;\n  url: string;\n}\n\n/**\n * EndpointMetadata contains metadata about a controller and his method.\n * Each annotation (@Get, @Body...) attached to a method are stored in a endpoint.\n * EndpointMetadata convert this metadata to an array which contain arguments to call an Express method.\n *\n * Example :\n *\n *    @Controller(\"/my-path\")\n *    provide MyClass {\n *\n *        @Get(\"/\")\n *        @Authenticated()\n *        public myMethod(){}\n *    }\n *\n */\n@JsonEntityComponent(DecoratorTypes.METHOD)\nexport class EndpointMetadata extends JsonEntityStore implements EndpointConstructorOptions {\n  // LIFECYCLE\n  @Enumerable()\n  public beforeMiddlewares: any[] = [];\n\n  @Enumerable()\n  public middlewares: any[] = [];\n\n  @Enumerable()\n  public afterMiddlewares: any[] = [];\n\n  @Enumerable()\n  public statusCode: number = 200;\n\n  constructor(options: EndpointConstructorOptions) {\n    super({\n      store: Store.fromMethod(options.target, options.propertyKey!),\n      descriptor: descriptorOf(options.target, options.propertyKey!),\n      ...options\n    });\n\n    const {beforeMiddlewares = [], middlewares = [], afterMiddlewares = []} = options;\n\n    this.after(afterMiddlewares);\n    this.before(beforeMiddlewares);\n    this.use(middlewares);\n  }\n\n  get targetName(): string {\n    return nameOf(this.token);\n  }\n\n  get params(): ParamMetadata[] {\n    return (Array.from(this.children.values()) as unknown) as ParamMetadata[];\n  }\n\n  /**\n   * Return the JsonOperation\n   */\n  get operation(): JsonOperation {\n    return this._operation;\n  }\n\n  get operationPaths() {\n    return this.operation.operationPaths;\n  }\n\n  get view(): EndpointViewOptions {\n    return this.store.get(\"view\") as EndpointViewOptions;\n  }\n\n  set view(view: EndpointViewOptions) {\n    this.store.set(\"view\", view);\n  }\n\n  get acceptMimes(): string[] {\n    return this.store.get<string[]>(\"acceptMimes\", []);\n  }\n\n  set acceptMimes(mimes: string[]) {\n    this.store.set(\"acceptMimes\", mimes);\n  }\n\n  /**\n   * Get all endpoints from a given class and his parents.\n   * @param {Type<any>} target\n   * @returns {EndpointMetadata[]}\n   */\n  static getEndpoints(target: Type<any>): EndpointMetadata[] {\n    const operations = getOperationsStores<EndpointMetadata>(target);\n\n    return Array.from(operations.values()).map((endpoint) => {\n      endpoint = endpoint.clone();\n      endpoint.token = classOf(target);\n\n      return endpoint;\n    });\n  }\n\n  /**\n   * Get an endpoint.\n   * @param target\n   * @param propertyKey\n   * @param descriptor\n   */\n  static get(target: Type<any>, propertyKey: string | symbol, descriptor?: PropertyDescriptor): EndpointMetadata {\n    descriptor = descriptor || descriptorOf(prototypeOf(target), propertyKey);\n\n    return JsonEntityStore.from<EndpointMetadata>(prototypeOf(target), propertyKey, descriptor);\n  }\n\n  addOperationPath(method: string, path: string | RegExp, options: any = {}) {\n    return this.operation.addOperationPath(method, path, options);\n  }\n\n  /**\n   * Find the a value at the controller level. Let this value be extended or overridden by the endpoint itself.\n   *\n   * @param key\n   * @returns {any}\n   */\n  get<T = any>(key: any): T {\n    const ctrlValue = Store.from(this.target).get(key);\n\n    return deepMerge<T>(ctrlValue, this.store.get(key));\n  }\n\n  /**\n   * Append middlewares to the beforeMiddlewares list.\n   * @param args\n   * @returns {EndpointMetadata}\n   */\n  public before(args: Function[]): this {\n    this.beforeMiddlewares = this.beforeMiddlewares.concat(args).filter(isFunction);\n\n    return this;\n  }\n\n  /**\n   * Append middlewares to the afterMiddlewares list.\n   * @param args\n   * @returns {EndpointMetadata}\n   */\n  public after(args: Function[]): this {\n    this.afterMiddlewares = this.afterMiddlewares.concat(args).filter(isFunction);\n\n    return this;\n  }\n\n  /**\n   * Store all arguments collected via Annotation.\n   * @param args\n   */\n  public use(args: Function[]) {\n    this.middlewares = this.middlewares.concat(args).filter(isFunction);\n\n    return this;\n  }\n\n  public clone() {\n    const endpoint = new EndpointMetadata({\n      ...this,\n      target: this.target,\n      propertyKey: this.propertyKey,\n      descriptor: this.descriptor,\n      store: this.store,\n      children: this.children\n    });\n\n    endpoint.collectionType = this.collectionType;\n    endpoint._type = this._type;\n    endpoint._operation = this.operation;\n    endpoint._schema = this._schema;\n    endpoint.middlewares = [...this.middlewares];\n    endpoint.afterMiddlewares = [...this.afterMiddlewares];\n    endpoint.beforeMiddlewares = [...this.beforeMiddlewares];\n\n    return endpoint;\n  }\n}\n","import {InjectorService} from \"@tsed/di\";\nimport {EndpointMetadata} from \"../domain/EndpointMetadata\";\nimport {HandlerMetadata, HandlerMetadataOptions} from \"../domain/HandlerMetadata\";\nimport {HandlerType} from \"../interfaces/HandlerType\";\nimport {PlatformRouteWithoutHandlers} from \"../interfaces/PlatformRouteOptions\";\n\nfunction isMetadata(input: any) {\n  return input instanceof HandlerMetadata;\n}\n\n/**\n * @ignore\n */\nexport function createHandlerMetadata(\n  injector: InjectorService,\n  obj: any | EndpointMetadata,\n  routeOptions: PlatformRouteWithoutHandlers = {}\n): HandlerMetadata {\n  if (isMetadata(obj)) {\n    return obj as HandlerMetadata;\n  }\n\n  let options: HandlerMetadataOptions;\n\n  if (obj instanceof EndpointMetadata) {\n    const provider = injector.getProvider(obj.token)!;\n\n    options = {\n      token: provider.token,\n      target: provider.useClass,\n      scope: provider.scope,\n      type: HandlerType.ENDPOINT,\n      propertyKey: obj.propertyKey\n    };\n  } else {\n    const provider = injector.getProvider(obj);\n\n    if (provider) {\n      options = {\n        token: provider.token,\n        target: provider.useClass,\n        scope: provider.scope,\n        type: HandlerType.MIDDLEWARE,\n        propertyKey: \"use\"\n      };\n    } else {\n      options = {\n        target: obj\n      };\n    }\n  }\n\n  options.routeOptions = routeOptions;\n\n  return new HandlerMetadata(options);\n}\n","import {JsonHeader} from \"@tsed/schema\";\nimport {PlatformContext} from \"../domain/PlatformContext\";\nimport {HeaderValue} from \"../services/PlatformResponse\";\n\nfunction mergeHeaders(specHeaders: Record<string, JsonHeader & {example: string}>, headers: Record<string, HeaderValue>) {\n  return Object.entries(specHeaders).reduce((headers, [key, item]) => {\n    key = key.toLowerCase();\n    return {\n      ...headers,\n      [key]: headers[key] === undefined ? String(item.example) : headers[key]\n    };\n  }, headers);\n}\n\n/**\n * @ignore\n */\nexport function setResponseHeaders(ctx: PlatformContext) {\n  const {response, endpoint} = ctx;\n  const {operation} = endpoint;\n\n  if (response.isDone()) {\n    return;\n  }\n\n  if (!response.hasStatus()) {\n    // apply status only if the isn't already modified\n    response.status(operation.getStatus());\n  }\n\n  const statusCode = response.statusCode;\n  const headers = operation.getHeadersOf(response.statusCode);\n  const mergedHeaders = mergeHeaders(headers, response.getHeaders());\n\n  response.setHeaders(mergedHeaders);\n\n  if (operation.isRedirection(statusCode)) {\n    response.redirect(statusCode, String(mergedHeaders[\"location\"]));\n  }\n}\n","import {Configuration, Injectable, InjectorService} from \"@tsed/di\";\nimport {deserialize, JsonDeserializerOptions, JsonSerializerOptions, serialize} from \"@tsed/json-mapper\";\nimport {ConverterSettings} from \"../config/interfaces/ConverterSettings\";\n\n@Injectable()\nexport class ConverterService {\n  #converterSettings: ConverterSettings;\n\n  constructor(private injectorService: InjectorService, @Configuration() configuration: Configuration) {\n    this.#converterSettings = configuration.get<ConverterSettings>(\"converter\") || {};\n  }\n\n  /**\n   * Convert instance to plainObject.\n   *\n   * @param obj\n   * @param options\n   */\n  serialize(obj: any, options: JsonSerializerOptions = {}): any {\n    return serialize(obj, {\n      useAlias: true,\n      additionalProperties: this.#converterSettings.additionalProperties === \"accept\",\n      ...options\n    });\n  }\n\n  /**\n   * Convert a plainObject to targetType.\n   *\n   * ### Options\n   *\n   * - `ignoreCallback`: callback called for each object which will be deserialized. The callback can return a boolean to avoid the default converter behavior.\n   * - `checkRequiredValue`: Disable the required check condition.\n   *\n   * @param obj Object source that will be deserialized\n   * @param options Mapping options\n   * @returns {any}\n   */\n  deserialize(obj: any, options: JsonDeserializerOptions = {}): any {\n    return deserialize(obj, {\n      useAlias: true,\n      additionalProperties: this.#converterSettings.additionalProperties === \"accept\",\n      ...options\n    });\n  }\n}\n","import {AnyToPromiseStatus, isBoolean, isFunction, isNumber, isStream, isString} from \"@tsed/core\";\nimport {Injectable, InjectorService, Provider, ProviderScope} from \"@tsed/di\";\nimport {$log} from \"@tsed/logger\";\nimport {ArgScope, HandlerWithScope, PlatformParams} from \"@tsed/platform-params\";\nimport {PlatformResponseFilter} from \"@tsed/platform-response-filter\";\nimport {renderView} from \"@tsed/platform-views\";\nimport {AnyToPromiseWithCtx} from \"../domain/AnyToPromiseWithCtx\";\nimport {EndpointMetadata} from \"../domain/EndpointMetadata\";\nimport {HandlerMetadata} from \"../domain/HandlerMetadata\";\nimport {PlatformContext} from \"../domain/PlatformContext\";\nimport {HandlerType} from \"../interfaces/HandlerType\";\nimport {PlatformRouteWithoutHandlers} from \"../interfaces/PlatformRouteOptions\";\nimport {createHandlerMetadata} from \"../utils/createHandlerMetadata\";\nimport {setResponseHeaders} from \"../utils/setResponseHeaders\";\nimport {ConverterService} from \"./ConverterService\";\n\nexport interface OnRequestOptions {\n  $ctx: PlatformContext;\n  metadata: HandlerMetadata;\n  handler: HandlerWithScope;\n  next?: any;\n  err?: any;\n\n  [key: string]: any;\n}\n\nfunction shouldBeSent(data: any) {\n  return Buffer.isBuffer(data) || isBoolean(data) || isNumber(data) || isString(data) || data === null;\n}\n\nfunction shouldBeSerialized(data: any) {\n  return !(isStream(data) || shouldBeSent(data) || data === undefined);\n}\n\n/**\n * Platform Handler abstraction layer. Wrap original class method to a pure platform handler (Express, Koa, etc...).\n * @platform\n */\n@Injectable({\n  scope: ProviderScope.SINGLETON\n})\nexport class PlatformHandler {\n  constructor(protected injector: InjectorService, protected params: PlatformParams) {}\n\n  /**\n   * Create a native middleware based on the given metadata and return an instance of AnyToPromiseWithCtx\n   * @param input\n   * @param options\n   */\n  createHandler(input: EndpointMetadata | HandlerMetadata | any, options: PlatformRouteWithoutHandlers = {}) {\n    return this.createRawHandler(createHandlerMetadata(this.injector, input, options));\n  }\n\n  /**\n   * Create injectable handler from the given provider\n   * @param provider\n   * @param propertyKey\n   */\n  createCustomHandler(provider: Provider, propertyKey: string) {\n    const handler = this.compileHandler(\n      new HandlerMetadata({\n        token: provider.provide,\n        target: provider.useClass,\n        type: HandlerType.CUSTOM,\n        scope: provider.scope,\n        propertyKey\n      })\n    );\n\n    return async ($ctx: PlatformContext, next?: any) =>\n      handler({\n        $ctx,\n        next\n      });\n  }\n\n  /**\n   * Send the response to the consumer.\n   * @param data\n   * @param ctx\n   * @protected\n   */\n  async flush(data: any, ctx: PlatformContext) {\n    const {response, endpoint} = ctx;\n\n    if (endpoint) {\n      if (endpoint.view) {\n        data = await this.render(data, ctx);\n      } else if (shouldBeSerialized(data)) {\n        data = this.injector.get<ConverterService>(ConverterService)!.serialize(data, {\n          ...endpoint.getResponseOptions(),\n          endpoint: true\n        });\n      }\n    }\n\n    if (!response.isDone()) {\n      const responseFilter = this.injector.get<PlatformResponseFilter>(PlatformResponseFilter)!;\n\n      response.body(responseFilter.transform(data, ctx));\n    }\n  }\n\n  compileHandler(metadata: HandlerMetadata) {\n    if (metadata.type === HandlerType.CTX_FN) {\n      return async (scope: Record<string, any>) => {\n        // @ts-ignore\n        return this.onCtxRequest({\n          ...scope,\n          handler: () => metadata.handler(scope.$ctx),\n          metadata\n        });\n      };\n    }\n\n    const promise = this.params.compileHandler<PlatformContext>({\n      token: metadata.token,\n      propertyKey: metadata.propertyKey,\n      getCustomArgs: metadata.injectable ? undefined : this.getDefaultArgs(metadata)\n    });\n\n    return async (scope: Record<string, any>) => {\n      const handler = await promise;\n      // @ts-ignore\n      return this.onRequest({\n        ...scope,\n        handler,\n        metadata\n      });\n    };\n  }\n\n  protected async onCtxRequest(requestOptions: OnRequestOptions): Promise<any> {\n    await requestOptions.handler(requestOptions);\n\n    return this.next(requestOptions);\n  }\n\n  /**\n   * Call handler when a request his handle\n   * @param requestOptions\n   */\n  protected async onRequest(requestOptions: OnRequestOptions): Promise<any> {\n    const {$ctx, metadata, err, handler} = requestOptions;\n    // istanbul ignore next\n    if (!$ctx) {\n      $log.error(\n        `Endpoint ${metadata.toString()} is called but the response is already send to your consumer. Check your code and his middlewares please!`\n      );\n      return;\n    }\n\n    const resolver = new AnyToPromiseWithCtx({$ctx, err});\n\n    return this.injector.runInContext($ctx, async () => {\n      try {\n        const {state, data, status, headers} = await resolver.call(handler);\n\n        if (state === AnyToPromiseStatus.RESOLVED) {\n          if (status) {\n            $ctx.response.status(status);\n          }\n\n          if (headers) {\n            $ctx.response.setHeaders(headers);\n          }\n\n          if (data !== undefined) {\n            $ctx.data = data;\n          }\n\n          // Can be canceled by the handler itself\n          return await this.onSuccess($ctx.data, requestOptions);\n        }\n      } catch (er) {\n        return this.onError(er, requestOptions);\n      }\n    });\n  }\n\n  protected async onError(er: unknown, requestOptions: OnRequestOptions) {\n    const {next, $ctx} = requestOptions;\n    $ctx.data = er;\n\n    if (!next) {\n      throw er;\n    }\n\n    return !$ctx.response.isHeadersSent() && next && next(er);\n  }\n\n  /**\n   * Manage success scenario\n   * @param data\n   * @param requestOptions\n   * @protected\n   */\n  protected async onSuccess(data: any, requestOptions: OnRequestOptions) {\n    const {metadata, $ctx, next} = requestOptions;\n\n    // TODO see this control is necessary\n    // istanbul ignore next\n    if ($ctx.request.isAborted() || $ctx.response.isDone()) {\n      return;\n    }\n\n    // set headers each times that an endpoint is called\n    if (metadata.type === HandlerType.ENDPOINT) {\n      this.setHeaders($ctx);\n    }\n\n    // call returned middleware\n    if (isFunction(data) && !isStream(data)) {\n      return this.callReturnedMiddleware(data, $ctx, next);\n    }\n\n    if (metadata.isFinal()) {\n      return this.flush(data, $ctx);\n    }\n\n    return this.next(requestOptions);\n  }\n\n  /**\n   * Call the returned middleware by the handler.\n   * @param middleware\n   * @param ctx\n   * @param next\n   * @protected\n   */\n  protected callReturnedMiddleware(middleware: any, ctx: PlatformContext, next: any) {\n    return middleware(ctx.getRequest(), ctx.getResponse(), next);\n  }\n\n  /**\n   * Render the view if the endpoint has a configured view.\n   * @param data\n   * @param ctx\n   * @protected\n   */\n  protected async render(data: any, ctx: PlatformContext) {\n    return renderView(data, ctx);\n  }\n\n  /**\n   * create Raw handler\n   * @param metadata\n   */\n  protected createRawHandler(metadata: HandlerMetadata) {\n    if ([HandlerType.RAW_ERR_FN, HandlerType.RAW_FN].includes(metadata.type)) {\n      return metadata.handler;\n    }\n\n    const handler = this.compileHandler(metadata);\n\n    return async (request: any, response: any, next: any) => {\n      return handler({\n        next,\n        $ctx: request.$ctx\n      });\n    };\n  }\n\n  /**\n   * Set response headers\n   * @param ctx\n   * @protected\n   */\n  protected setHeaders(ctx: PlatformContext) {\n    return setResponseHeaders(ctx);\n  }\n\n  protected next(requestOptions: OnRequestOptions) {\n    const {$ctx, next} = requestOptions;\n\n    return !$ctx.response.isDone() && next && next();\n  }\n\n  protected getDefaultArgs(metadata: HandlerMetadata) {\n    return async (scope: ArgScope<PlatformContext>) =>\n      [\n        metadata.hasErrorParam && scope.err,\n        scope.$ctx.request.request,\n        scope.$ctx.response.response,\n        metadata.hasNextFunction && scope.next\n      ].filter(Boolean);\n  }\n}\n","import {Inject, Injectable, InjectorService, ProviderScope} from \"@tsed/di\";\nimport {promisify} from \"util\";\nimport {PlatformMulter, PlatformMulterSettings, PlatformStaticsOptions} from \"../config\";\nimport {PathType, PlatformRouteWithoutHandlers, PlatformRouteOptions} from \"../interfaces\";\nimport {createFakeRawDriver} from \"./FakeRawDriver\";\nimport {PlatformHandler} from \"./PlatformHandler\";\n\n/**\n * @ignore\n */\nexport const PLATFORM_ROUTER_OPTIONS = Symbol.for(\"PlatformRouterOptions\");\n\ndeclare global {\n  namespace TsED {\n    // @ts-ignore\n    export interface Router {}\n  }\n}\n\n/**\n * Platform Router abstraction layer.\n * @platform\n */\n@Injectable({\n  scope: ProviderScope.INSTANCE\n})\nexport class PlatformRouter<Router = TsED.Router> {\n  rawRouter: Router;\n  raw: any;\n\n  @Inject()\n  injector: InjectorService;\n\n  constructor(protected platformHandler: PlatformHandler) {\n    this.rawRouter = this.raw = PlatformRouter.createRawRouter();\n  }\n\n  /**\n   * Create a new instance of PlatformRouter\n   * @param injector\n   * @param routerOptions\n   */\n  static create(injector: InjectorService, routerOptions: any = {}) {\n    const locals = new Map();\n    locals.set(PLATFORM_ROUTER_OPTIONS, routerOptions);\n\n    return injector.invoke<PlatformRouter>(PlatformRouter, locals);\n  }\n\n  protected static createRawRouter(): any {\n    return createFakeRawDriver();\n  }\n\n  callback(): any {\n    return this.raw;\n  }\n\n  getRouter(): Router {\n    return this.rawRouter;\n  }\n\n  use(...handlers: any[]) {\n    // @ts-ignore\n    this.getRouter().use(...this.mapHandlers(handlers));\n\n    return this;\n  }\n\n  addRoute(options: PlatformRouteOptions) {\n    const {method, path, handlers, isFinal} = options;\n    // @ts-ignore\n    this.getRouter()[method](path, ...this.mapHandlers(handlers, {method, path, isFinal}));\n\n    return this;\n  }\n\n  all(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"all\", path, handlers, isFinal: true});\n  }\n\n  get(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"get\", path, handlers, isFinal: true});\n  }\n\n  post(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"post\", path, handlers, isFinal: true});\n  }\n\n  put(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"put\", path, handlers, isFinal: true});\n  }\n\n  delete(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"delete\", path, handlers, isFinal: true});\n  }\n\n  patch(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"patch\", path, handlers, isFinal: true});\n  }\n\n  head(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"head\", path, handlers, isFinal: true});\n  }\n\n  options(path: PathType, ...handlers: any[]) {\n    return this.addRoute({method: \"options\", path, handlers, isFinal: true});\n  }\n\n  statics(path: string, options: PlatformStaticsOptions): this {\n    return this;\n  }\n\n  multer(options: PlatformMulterSettings): PlatformMulter {\n    const m = require(\"multer\")(options);\n\n    const makePromise = (multer: any, name: string) => {\n      // istanbul ignore next\n      if (!multer[name]) return;\n\n      const fn = multer[name];\n\n      multer[name] = function apply(...args: any[]) {\n        const middleware = Reflect.apply(fn, this, args);\n\n        return (req: any, res: any) => promisify(middleware)(req, res);\n      };\n    };\n\n    makePromise(m, \"any\");\n    makePromise(m, \"array\");\n    makePromise(m, \"fields\");\n    makePromise(m, \"none\");\n    makePromise(m, \"single\");\n\n    return m;\n  }\n\n  protected mapHandlers(handlers: any[], options: PlatformRouteWithoutHandlers = {}): any[] {\n    return handlers.reduce((list, handler, index) => {\n      if (typeof handler === \"string\") {\n        return list.concat(handler);\n      }\n\n      if (handler instanceof PlatformRouter) {\n        return list.concat(handler.callback());\n      }\n\n      return list.concat(\n        this.platformHandler.createHandler(handler, {\n          ...options,\n          isFinal: options.isFinal ? index === handlers.length - 1 : false\n        })\n      );\n    }, []);\n  }\n}\n","import {Injectable, ProviderScope} from \"@tsed/di\";\nimport {createFakeRawDriver} from \"./FakeRawDriver\";\nimport {PlatformHandler} from \"./PlatformHandler\";\nimport {PlatformRouter} from \"./PlatformRouter\";\n\ndeclare global {\n  namespace TsED {\n    // @ts-ignore\n    export interface Application {}\n  }\n}\n\n/**\n * `PlatformApplication` is used to provide all routes collected by annotation `@Controller`.\n *\n * @platform\n */\n@Injectable({\n  scope: ProviderScope.SINGLETON\n})\nexport class PlatformApplication<App = TsED.Application, Router = TsED.Router> extends PlatformRouter<Router> {\n  raw: App;\n  rawApp: App;\n  rawRouter: Router;\n\n  constructor(platformHandler: PlatformHandler) {\n    super(platformHandler);\n    this.rawApp = this.raw = PlatformApplication.createRawApp() as any;\n  }\n\n  protected static createRawApp(): any {\n    return createFakeRawDriver();\n  }\n\n  getApp(): App {\n    return this.raw;\n  }\n}\n","import {Constant, Inject} from \"@tsed/di\";\nimport {Exception} from \"@tsed/exceptions\";\nimport {Middleware, MiddlewareMethods} from \"@tsed/platform-middlewares\";\nimport {Context} from \"@tsed/platform-params\";\nimport {PlatformMulterField, PlatformMulterSettings} from \"../config\";\nimport {PlatformApplication} from \"../services/PlatformApplication\";\n\nexport interface MulterInputOptions {\n  fields: PlatformMulterField[];\n}\n\n/**\n * @middleware\n */\n@Middleware()\nexport class PlatformMulterMiddleware implements MiddlewareMethods {\n  @Constant(\"multer\", {})\n  settings: PlatformMulterSettings;\n\n  @Inject()\n  app: PlatformApplication;\n\n  async use(@Context() ctx: Context) {\n    try {\n      const {fields, options = {}} = ctx.endpoint.get(PlatformMulterMiddleware);\n      const settings: PlatformMulterSettings = {\n        ...this.settings,\n        ...options\n      };\n\n      /* istanbul ignore next */\n      if (settings.storage) {\n        delete settings.dest;\n      }\n\n      const middleware = this.app.multer(settings).fields(this.getFields({fields}));\n\n      return await middleware(ctx.getRequest(), ctx.getResponse());\n    } catch (er) {\n      throw er.code ? new Exception(er.code, `${er.message} ${er.field || \"\"}`.trim()) : er;\n    }\n  }\n\n  protected getFields(conf: MulterInputOptions) {\n    return conf.fields.map(({name, maxCount}) => ({name, maxCount}));\n  }\n}\n","import {Middleware, MiddlewareMethods} from \"@tsed/platform-middlewares\";\nimport {Context} from \"@tsed/platform-params\";\n\n/**\n * @deprecated Since 2020-11-30. Use PlatformAcceptMimesMiddleware.\n * @ignore\n */\n@Middleware()\nexport class GlobalAcceptMimesMiddleware implements MiddlewareMethods {\n  use(@Context() ctx: Context) {\n    return;\n  }\n}\n","import {uniq} from \"@tsed/core\";\nimport {Constant} from \"@tsed/di\";\nimport {NotAcceptable} from \"@tsed/exceptions\";\nimport {Middleware, MiddlewareMethods} from \"@tsed/platform-middlewares\";\nimport {Context} from \"@tsed/platform-params\";\n\n/**\n * @middleware\n * @platform\n */\n@Middleware()\nexport class PlatformAcceptMimesMiddleware implements MiddlewareMethods {\n  @Constant(\"acceptMimes\", [])\n  acceptMimes: string[];\n\n  public use(@Context() ctx: Context): void {\n    const {endpoint, request} = ctx;\n    const mimes = uniq((endpoint?.get(\"acceptMimes\") || []).concat(this.acceptMimes));\n\n    if (mimes.length && !request.accepts(mimes)) {\n      throw new NotAcceptable(mimes.join(\", \"));\n    }\n  }\n}\n","import {Context} from \"@tsed/platform-params\";\nimport {Middleware, MiddlewareMethods} from \"@tsed/platform-middlewares\";\n\n/**\n * @middleware\n * @deprecated Since 2020-11-30. Use PlatformAcceptMimesMiddleware.\n * @ignore\n */\n@Middleware()\nexport class AcceptMimesMiddleware implements MiddlewareMethods {\n  public use(@Context() ctx: Context): void {\n    return;\n  }\n}\n","import {PlatformContext} from \"../domain/PlatformContext\";\nimport {HandlerType} from \"../interfaces/HandlerType\";\n\nexport type PlatformCtxHandler = ($ctx: PlatformContext) => any | Promise<any>;\n\n/**\n * Create Ts.ED context handler\n * @param fn\n * @ignore\n */\nexport function useCtxHandler(fn: PlatformCtxHandler & {type?: HandlerType}) {\n  fn.type = HandlerType.CTX_FN;\n\n  return fn;\n}\n","import {Type} from \"@tsed/core\";\nimport {InjectorService} from \"@tsed/di\";\nimport {ParamMetadata, ParamTypes} from \"@tsed/platform-params\";\nimport {JsonMethodPath, OperationMethods} from \"@tsed/schema\";\nimport {EndpointMetadata} from \"../domain/EndpointMetadata\";\nimport {ControllerProvider} from \"../domain/ControllerProvider\";\nimport {PlatformRouterMethods} from \"../interfaces/PlatformRouterMethods\";\nimport {bindEndpointMiddleware} from \"../middlewares/bindEndpointMiddleware\";\nimport {PlatformAcceptMimesMiddleware} from \"../middlewares/PlatformAcceptMimesMiddleware\";\nimport {PlatformMulterMiddleware} from \"../middlewares/PlatformMulterMiddleware\";\nimport {PlatformRouter} from \"../services/PlatformRouter\";\nimport {useCtxHandler} from \"../utils/useCtxHandler\";\n\n/**\n * @ignore\n */\nfunction formatMethod(method: string | undefined) {\n  return (method === OperationMethods.CUSTOM ? \"use\" : method || \"use\").toLowerCase();\n}\n\n/**\n * @ignore\n */\nexport class PlatformControllerBuilder {\n  constructor(private provider: ControllerProvider) {}\n\n  /**\n   *\n   * @returns {any}\n   */\n  public build(injector: InjectorService): PlatformRouterMethods {\n    const {\n      middlewares: {useBefore}\n    } = this.provider;\n\n    // Controller lifecycle\n    this.buildMiddlewares(useBefore) // Controller before-middleware\n      .buildEndpoints() // All endpoints and his middlewares\n      .buildChildrenCtrls(injector); // Children controllers\n\n    return this.provider.getRouter();\n  }\n\n  private buildEndpoints() {\n    const {endpoints} = this.provider;\n    const operationPaths: Map<string, JsonMethodPath> = new Map();\n    const getKey = (method: string, path: any) => `${method}-${path}`;\n\n    const updateFinalRouteState = (key: string) => {\n      if (operationPaths.has(key)) {\n        operationPaths.get(key)!.isFinal = false;\n      }\n    };\n\n    const setFinalRoute = (key: string, operationPath: JsonMethodPath) => {\n      operationPaths.set(key, operationPath);\n      operationPath.isFinal = true;\n    };\n\n    endpoints.forEach(({operation}) => {\n      operation?.operationPaths.forEach((operationPath) => {\n        if (operationPath.method !== OperationMethods.CUSTOM) {\n          const key = getKey(operationPath.method, operationPath.path);\n          updateFinalRouteState(key);\n          updateFinalRouteState(getKey(OperationMethods.ALL, operationPath.path));\n\n          setFinalRoute(key, operationPath);\n        }\n      });\n    });\n\n    endpoints.forEach((endpoint) => {\n      this.buildEndpoint(endpoint);\n    });\n\n    return this;\n  }\n\n  private buildEndpoint(endpoint: EndpointMetadata) {\n    const {beforeMiddlewares, middlewares: mldwrs, afterMiddlewares, operation} = endpoint;\n    const {\n      middlewares: {use, useAfter}\n    } = this.provider;\n\n    const router = this.provider.getRouter<PlatformRouter>();\n    // Endpoint lifecycle\n    let handlers: any[] = [];\n\n    const hasFiles = [...endpoint.children.values()].find((item: ParamMetadata) => item.paramType === ParamTypes.FILES);\n\n    handlers = handlers\n      .concat(useCtxHandler(bindEndpointMiddleware(endpoint)))\n      .concat(PlatformAcceptMimesMiddleware)\n      .concat(hasFiles && PlatformMulterMiddleware)\n      .concat(use) // Controller use-middlewares\n      .concat(beforeMiddlewares) // Endpoint before-middlewares\n      // .concat(endpoint.cache && PlatformCacheMiddleware)\n      .concat(mldwrs) // Endpoint middlewares\n      .concat(endpoint) // Endpoint metadata\n      .concat(afterMiddlewares) // Endpoint after-middlewares\n      .concat(useAfter) // Controller after middlewares (equivalent to afterEach)\n      .filter((item: any) => !!item);\n\n    // Add handlers to the router\n    operation?.operationPaths.forEach(({path, method, isFinal}) => {\n      router.addRoute({\n        method: formatMethod(method),\n        path,\n        handlers,\n        isFinal\n      });\n    });\n\n    if (!operation?.operationPaths.size) {\n      router.use(...handlers);\n    }\n  }\n\n  private buildChildrenCtrls(injector: InjectorService) {\n    const {children} = this.provider;\n    const router = this.provider.getRouter<PlatformRouter>();\n\n    children.forEach((child: Type<any>) => {\n      const provider = injector.getProvider(child) as ControllerProvider;\n\n      /* istanbul ignore next */\n      if (!provider) {\n        throw new Error(\"Controller component not found in the ControllerRegistry\");\n      }\n\n      new PlatformControllerBuilder(provider).build(injector);\n\n      router.use(provider.path, provider.getRouter<PlatformRouter>());\n    });\n  }\n\n  private buildMiddlewares(middlewares: any[]) {\n    const router = this.provider.getRouter<PlatformRouter>();\n\n    middlewares\n      .filter((o) => typeof o === \"function\")\n      .forEach((middleware: any) => {\n        router.use(middleware);\n      });\n\n    return this;\n  }\n}\n","import {Injectable, ProviderScope, Scope} from \"@tsed/di\";\nimport {IncomingHttpHeaders, IncomingMessage} from \"http\";\nimport type {PlatformContext} from \"../domain/PlatformContext\";\nimport {IncomingEvent} from \"../interfaces/IncomingEvent\";\nimport type {PlatformResponse} from \"./PlatformResponse\";\n\ndeclare global {\n  namespace TsED {\n    // @ts-ignore\n    export interface Request {\n      id: string;\n      $ctx: PlatformContext;\n    }\n  }\n}\n\n/**\n * Platform Request abstraction layer.\n * @platform\n */\n@Injectable()\n@Scope(ProviderScope.INSTANCE)\nexport class PlatformRequest<T extends {[key: string]: any} = any> {\n  public raw: T;\n\n  /**\n   * The current @@PlatformResponse@@.\n   */\n  public response: PlatformResponse;\n\n  constructor({request}: IncomingEvent) {\n    this.raw = request as any;\n  }\n\n  get secure(): boolean {\n    return this.raw.secure;\n  }\n\n  get host(): string {\n    return this.get(\"host\");\n  }\n\n  get protocol(): string {\n    return this.raw.protocol;\n  }\n\n  /**\n   * Get the url of the request.\n   *\n   * Is equivalent of `express.response.originalUrl || express.response.url`.\n   */\n  get url(): string {\n    return this.raw.originalUrl || this.raw.url;\n  }\n\n  get headers(): IncomingHttpHeaders {\n    return this.raw.headers;\n  }\n\n  get method(): string {\n    return this.raw.method;\n  }\n\n  /**\n   * Contains key-value pairs of data submitted in the request body. By default, it is `undefined`, and is populated when you use\n   * `body-parsing` middleware such as `express.json()` or `express.urlencoded()`.\n   */\n  get body(): any {\n    return this.raw.body;\n  }\n\n  get rawBody(): any {\n    return this.raw.rawBody;\n  }\n\n  /**\n   * When using `cookie-parser` middleware, this property is an object that contains cookies sent by the request.\n   * If the request contains no cookies, it defaults to `{}`.\n   */\n  get cookies(): {[key: string]: any} {\n    return this.raw.cookies;\n  }\n\n  /**\n   * This property is an object containing properties mapped to the named route `parameters`.\n   * For example, if you have the route `/user/:name`, then the `name` property is available as `req.params.name`.\n   * This object defaults to `{}`.\n   */\n  get params(): {[key: string]: any} {\n    return this.raw.params;\n  }\n\n  /**\n   * This property is an object containing a property for each query string parameter in the route.\n   * When query parser is set to disabled, it is an empty object `{}`, otherwise it is the result of the configured query parser.\n   */\n  get query(): {[key: string]: any} {\n    return this.raw.query;\n  }\n\n  /**\n   * This property is an object containing a property for each session attributes set by any code.\n   * It require to install a middleware like express-session to work.\n   */\n  get session(): {[key: string]: any} {\n    return this.raw.session as any;\n  }\n\n  get files() {\n    return this.raw.files;\n  }\n\n  /**\n   * Return the original request framework instance\n   */\n  get request() {\n    return this.getRequest();\n  }\n\n  /**\n   * Return the original request node.js instance\n   */\n  get req() {\n    return this.getReq();\n  }\n\n  /**\n   * Returns the HTTP request header specified by field. The match is case-insensitive.\n   *\n   * ```typescript\n   * request.get('Content-Type') // => \"text/plain\"\n   * ```\n   *\n   * @param name\n   */\n  get(name: string) {\n    return this.raw.get(name);\n  }\n\n  /**\n   * Checks if the specified content types are acceptable, based on the request’s Accept HTTP header field. The method returns the best match, or if none of the specified content types is acceptable, returns false (in which case, the application should respond with 406 \"Not Acceptable\").\n   *\n   * The type value may be a single MIME type string (such as “application/json”), an extension name such as “json”, a comma-delimited list, or an array. For a list or array, the method returns the best match (if any).\n   *\n   * @param mime\n   */\n  accepts(mime: string): string | false;\n\n  accepts(mime: string[]): string[] | false;\n\n  accepts(mime?: string | string[]): string | string[] | false {\n    // @ts-ignore\n    return this.raw.accepts(mime);\n  }\n\n  isAborted() {\n    return this.raw.aborted;\n  }\n\n  destroy() {\n    // @ts-ignore\n    delete this.raw;\n    // @ts-ignore\n    delete this.response;\n  }\n\n  /**\n   * Return the Framework response object (express, koa, etc...)\n   */\n  getRequest<Req = T>(): Req {\n    return this.raw as any;\n  }\n\n  /**\n   * Return the Node.js response object\n   */\n  getReq(): IncomingMessage {\n    return this.raw as any;\n  }\n}\n","import {isBoolean, isNumber, isStream, isString} from \"@tsed/core\";\nimport {Injectable, ProviderScope, Scope} from \"@tsed/di\";\nimport {PlatformViews} from \"@tsed/platform-views\";\nimport {ServerResponse} from \"http\";\nimport {IncomingEvent} from \"../interfaces/IncomingEvent\";\nimport type {PlatformRequest} from \"./PlatformRequest\";\n\nconst onFinished = require(\"on-finished\");\n\ndeclare global {\n  namespace TsED {\n    // @ts-ignore\n    export interface Response {\n      // req: any;\n    }\n  }\n}\n\nexport type HeaderValue = Array<boolean | number | string> | boolean | number | string;\n\n/**\n * Platform Response abstraction layer.\n * @platform\n */\n@Injectable()\n@Scope(ProviderScope.INSTANCE)\nexport class PlatformResponse<T extends Record<string, any> = any> {\n  platformViews: PlatformViews;\n\n  /**\n   * The current @@PlatformRequest@@.\n   */\n  public request: PlatformRequest;\n\n  data: any;\n\n  raw: T;\n\n  constructor({response}: IncomingEvent) {\n    this.raw = response as any;\n  }\n\n  /**\n   * Get the current statusCode\n   */\n  get statusCode() {\n    return this.raw.statusCode;\n  }\n\n  /**\n   * An object that contains response local variables scoped to the request, and therefore available only to the view(s) rendered during that request / response cycle (if any). Otherwise, this property is identical to app.locals.\n   *\n   * This property is useful for exposing request-level information such as the request path name, authenticated user, user settings, and so on.\n   */\n  get locals() {\n    return this.raw.locals;\n  }\n\n  /**\n   * Return the original response framework instance\n   */\n  get response() {\n    return this.getResponse();\n  }\n\n  /**\n   * Return the original response node.js instance\n   */\n  get res() {\n    return this.getRes();\n  }\n\n  static onFinished(res: any, cb: Function) {\n    onFinished(res, cb);\n  }\n\n  /**\n   * Returns the HTTP response header specified by field. The match is case-insensitive.\n   *\n   * ```typescript\n   * response.get('Content-Type') // => \"text/plain\"\n   * ```\n   *\n   * @param name\n   */\n  get(name: string) {\n    return this.raw.get(name);\n  }\n\n  getHeaders(): Record<string, HeaderValue> {\n    return this.raw.getHeaders();\n  }\n\n  /**\n   * Return the Framework response object (express, koa, etc...)\n   */\n  getResponse<Res = T>(): Res {\n    return this.raw as any;\n  }\n\n  /**\n   * Return the Node.js response object\n   */\n  getRes(): ServerResponse {\n    return this.raw as any;\n  }\n\n  hasStatus() {\n    return this.statusCode !== 200;\n  }\n\n  /**\n   * Sets the HTTP status for the response.\n   *\n   * @param status\n   */\n  status(status: number) {\n    this.raw.status(status);\n\n    return this;\n  }\n\n  /**\n   * Set header `field` to `val`, or pass\n   * an object of header fields.\n   *\n   * Examples:\n   * ```typescript\n   * response.setHeaders({ Accept: 'text/plain', 'X-API-Key': 'tobi' });\n   * ```\n   *\n   * Aliased as `res.header()`.\n   */\n  setHeaders(headers: Record<string, HeaderValue>) {\n    // apply headers\n    Object.entries(headers).forEach(([key, item]) => {\n      this.setHeader(key, item);\n    });\n\n    return this;\n  }\n\n  setHeader(key: string, item: any) {\n    if (key.toLowerCase() === \"location\") {\n      return this.location(String(item));\n    }\n\n    this.raw.set(key, item);\n\n    return this;\n  }\n\n  /**\n   * Set `Content-Type` response header with `type` through `mime.lookup()`\n   * when it does not contain \"/\", or set the Content-Type to `type` otherwise.\n   *\n   * Examples:\n   *\n   *     res.type('.html');\n   *     res.type('html');\n   *     res.type('json');\n   *     res.type('application/json');\n   *     res.type('png');\n   */\n  contentType(contentType: string) {\n    this.raw.contentType(contentType);\n\n    return this;\n  }\n\n  contentLength(length: number) {\n    this.setHeader(\"Content-Length\", length);\n    return this;\n  }\n\n  getContentLength() {\n    if (this.get(\"Content-Length\")) {\n      return parseInt(this.get(\"Content-Length\"), 10) || 0;\n    }\n  }\n\n  getContentType() {\n    return (this.get(\"Content-Type\") || \"\").split(\";\")[0];\n  }\n\n  /**\n   * Sets the HTTP response Content-Disposition header field to “attachment”.\n   * If a filename is given, then it sets the Content-Type based on the extension name via res.type(), and sets the Content-Disposition “filename=” parameter.\n   *\n   * ```typescript\n   * res.attachment()\n   * // Content-Disposition: attachment\n   *\n   * res.attachment('path/to/logo.png')\n   * // Content-Disposition: attachment; filename=\"logo.png\"\n   * // Content-Type: image/png\n   * ```\n   *\n   * @param filename\n   */\n  attachment(filename: string) {\n    this.raw.attachment(filename);\n    return this;\n  }\n\n  /**\n   * Redirects to the URL derived from the specified path, with specified status, a positive integer that corresponds to an [HTTP status code](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).\n   * If not specified, status defaults to `302 Found`.\n   *\n   * @param status\n   * @param url\n   */\n  redirect(status: number, url: string) {\n    this.raw.redirect(status, url);\n\n    return this;\n  }\n\n  /**\n   * Sets the response Location HTTP header to the specified path parameter.\n   *\n   * @param location\n   */\n  location(location: string) {\n    this.raw.location(location);\n\n    return this;\n  }\n\n  /**\n   * Stream the given data.\n   *\n   * @param data\n   */\n  stream(data: ReadableStream | any) {\n    data.pipe(this.raw);\n\n    return this;\n  }\n\n  /**\n   * Renders a view and sends the rendered HTML string to the client.\n   *\n   * @param path\n   * @param options\n   */\n  async render(path: string, options: any = {}) {\n    return this.platformViews.render(path, {\n      ...this.locals,\n      ...options\n    });\n  }\n\n  /**\n   * Send any data to your consumer.\n   *\n   * This method accept a ReadableStream, a plain object, boolean, string, number, null and undefined data.\n   * It choose the better way to send the data.\n   *\n   * @param data\n   */\n  body(data: any) {\n    this.data = data;\n    if (data === undefined) {\n      this.raw.send();\n\n      return this;\n    }\n\n    if (isStream(data)) {\n      this.stream(data);\n\n      return this;\n    }\n\n    if (Buffer.isBuffer(data)) {\n      if (!this.getContentType()) {\n        this.contentType(\"application/octet-stream\");\n      }\n\n      this.contentLength(data.length);\n      this.raw.send(data);\n\n      return this;\n    }\n\n    if (isBoolean(data) || isNumber(data) || isString(data) || data === null) {\n      this.raw.send(data);\n\n      return this;\n    }\n\n    this.raw.json(data);\n\n    return this;\n  }\n\n  getBody() {\n    return this.data;\n  }\n\n  /**\n   * Add a listener to handler the end of the request/response.\n   * @param cb\n   */\n  onEnd(cb: Function): this {\n    PlatformResponse.onFinished(this.getRes(), cb);\n\n    return this;\n  }\n\n  isDone(): boolean {\n    if (!this.raw) {\n      return true;\n    }\n\n    const res = this.getRes();\n\n    return Boolean(this.isHeadersSent() || res.writableEnded || res.writableFinished);\n  }\n\n  destroy() {\n    // @ts-ignore\n    delete this.raw;\n    delete this.data;\n    // @ts-ignore\n    delete this.request;\n  }\n\n  isHeadersSent() {\n    return this.getRes().headersSent;\n  }\n}\n","import {ContextMethods, DIContext, DIContextOptions} from \"@tsed/di\";\nimport {IncomingMessage, ServerResponse} from \"http\";\nimport {EndpointMetadata} from \"./EndpointMetadata\";\nimport {PlatformApplication} from \"../services/PlatformApplication\";\nimport {PlatformRequest} from \"../services/PlatformRequest\";\nimport {PlatformResponse} from \"../services/PlatformResponse\";\n\ndeclare global {\n  namespace TsED {\n    export interface Context extends PlatformContext {}\n  }\n}\n\nexport interface PlatformContextOptions extends DIContextOptions {\n  event: {\n    response?: ServerResponse;\n    request?: IncomingMessage;\n  };\n  ignoreUrlPatterns?: any[];\n  endpoint?: EndpointMetadata;\n}\n\nexport class PlatformContext extends DIContext implements ContextMethods {\n  /**\n   * The current @@EndpointMetadata@@ resolved by Ts.ED during the request.\n   */\n  public endpoint: EndpointMetadata;\n  /**\n   * The data return by the previous endpoint if you use multiple handler on the same route. By default data is empty.\n   */\n  public data: any;\n  /**\n   * The current @@PlatformResponse@@.\n   */\n  public response: PlatformResponse;\n  /**\n   * The current @@PlatformRequest@@.\n   */\n  public request: PlatformRequest;\n\n  #ignoreUrlPatterns: RegExp[] = [];\n\n  constructor({\n    event,\n    endpoint,\n    ignoreUrlPatterns = [],\n    ResponseKlass = PlatformResponse,\n    RequestKlass = PlatformRequest,\n    ...options\n  }: PlatformContextOptions) {\n    super({\n      ...options,\n      ignoreLog: () => {\n        return this.#ignoreUrlPatterns.find((reg) => !!this.url.match(reg));\n      }\n    });\n\n    endpoint && (this.endpoint = endpoint);\n\n    this.#ignoreUrlPatterns = ignoreUrlPatterns.map((pattern: string | RegExp) =>\n      typeof pattern === \"string\" ? new RegExp(pattern, \"gi\") : pattern\n    );\n\n    this.response = new ResponseKlass(event);\n    this.request = new RequestKlass(event);\n\n    this.response.request = this.request;\n    this.request.response = this.response;\n\n    this.request.request.$ctx = this;\n    this.request.request.id = this.id;\n    this.logger.url = this.url;\n\n    this.container.set(PlatformResponse, this.response);\n    this.container.set(PlatformRequest, this.request);\n    this.container.set(PlatformContext, this);\n\n    this.response.setHeader(\"x-request-id\", this.id);\n  }\n\n  get url() {\n    return this.request.url;\n  }\n\n  get app() {\n    return this.injector.get<PlatformApplication>(PlatformApplication)!;\n  }\n\n  async destroy() {\n    await super.destroy();\n\n    delete this.request?.request?.$ctx;\n\n    this.response.destroy();\n    this.request.destroy();\n\n    // @ts-ignore\n    delete this.endpoint;\n    // @ts-ignore\n    delete this.response;\n    // @ts-ignore\n    delete this.request;\n  }\n\n  isDone() {\n    return !this.request || !this.response;\n  }\n\n  /**\n   * Return the framework request instance (Express, Koa, etc...)\n   */\n  getRequest<Req = any>(): Req {\n    return this.request.getRequest<Req>();\n  }\n\n  /**\n   * Return the framework response instance (Express, Koa, etc...)\n   */\n  getResponse<Res = any>(): Res {\n    return this.response.getResponse<Res>();\n  }\n\n  /**\n   * Get Node.js request\n   */\n  getReq(): IncomingMessage {\n    return this.request.getReq();\n  }\n\n  /**\n   * Get Node.js response\n   */\n  getRes(): ServerResponse {\n    return this.response.getRes();\n  }\n\n  /**\n   * Return the original application instance.\n   */\n  getApp<T = any>(): T {\n    return this.app.getApp() as any;\n  }\n}\n","import {ParamTypes} from \"@tsed/platform-params\";\nimport {EndpointMetadata} from \"./EndpointMetadata\";\nimport {ControllerProvider} from \"./ControllerProvider\";\n\nexport interface PlatformRouterDetailsOptions {\n  provider: ControllerProvider;\n  endpoint: EndpointMetadata;\n  method: string;\n  url: string;\n}\n\nexport class PlatformRouteDetails {\n  readonly method: string;\n  readonly url: string;\n  readonly rawBody: boolean;\n  readonly endpoint: EndpointMetadata;\n  readonly provider: ControllerProvider;\n\n  constructor({provider, endpoint, method, url}: PlatformRouterDetailsOptions) {\n    this.provider = provider;\n    this.endpoint = endpoint;\n    this.method = method;\n    this.url = url;\n    this.rawBody = !!endpoint.params.find((param) => param.paramType === ParamTypes.RAW_BODY);\n  }\n\n  get name() {\n    return `${this.endpoint.targetName}.${this.methodClassName}()`;\n  }\n\n  get className() {\n    return this.endpoint.targetName;\n  }\n\n  get methodClassName() {\n    return String(this.endpoint.propertyKey);\n  }\n\n  get parameters() {\n    return this.endpoint.params;\n  }\n\n  toJSON() {\n    return {\n      method: this.method,\n      name: this.name,\n      url: this.url,\n      className: this.className,\n      methodClassName: this.methodClassName,\n      parameters: this.parameters,\n      rawBody: this.rawBody\n    };\n  }\n}\n","export const ROUTER_OPTIONS = Symbol.for(\"ROUTER_OPTIONS\");\n","import {Provider, ProviderType, TokenProvider} from \"@tsed/di\";\nimport {JsonEntityStore} from \"@tsed/schema\";\nimport {ROUTER_OPTIONS} from \"../constants/routerOptions\";\nimport {ControllerMiddlewares} from \"../decorators/class/controller\";\nimport {PlatformRouterMethods} from \"../interfaces/PlatformRouterMethods\";\nimport {EndpointMetadata} from \"./EndpointMetadata\";\n\nexport class ControllerProvider<T = any> extends Provider<T> {\n  readonly entity: JsonEntityStore;\n  private router: PlatformRouterMethods;\n\n  constructor(provide: TokenProvider, options: Partial<Provider> = {}) {\n    super(provide, options);\n    this.type = ProviderType.CONTROLLER;\n    this.entity = JsonEntityStore.from(provide);\n  }\n\n  get path() {\n    return this.entity.path;\n  }\n\n  set path(path: string) {\n    this.entity.path = path;\n  }\n\n  /**\n   *\n   * @returns {EndpointMetadata[]}\n   */\n  get endpoints(): EndpointMetadata[] {\n    return EndpointMetadata.getEndpoints(this.provide);\n  }\n\n  get children(): TokenProvider[] {\n    return this.store.get(\"childrenControllers\", []);\n  }\n\n  /**\n   *\n   * @returns {ControllerProvider}\n   */\n  get parent(): TokenProvider | undefined {\n    return this.store.get(\"parentController\");\n  }\n\n  /**\n   *\n   */\n  get routerOptions(): any {\n    return this.store.get(ROUTER_OPTIONS) || ({} as any);\n  }\n\n  /**\n   *\n   * @param value\n   */\n  set routerOptions(value: any) {\n    this.store.set(ROUTER_OPTIONS, value);\n  }\n\n  /**\n   *\n   * @returns {any[]}\n   */\n  get middlewares(): ControllerMiddlewares {\n    return Object.assign(\n      {\n        use: [],\n        useAfter: [],\n        useBefore: []\n      },\n      this.store.get(\"middlewares\", {})\n    );\n  }\n\n  /**\n   *\n   * @param middlewares\n   */\n  set middlewares(middlewares: ControllerMiddlewares) {\n    const mdlwrs = this.middlewares;\n    const concat = (key: string, a: any, b: any) => (a[key] = a[key].concat(b[key]));\n\n    Object.keys(middlewares).forEach((key: string) => {\n      concat(key, mdlwrs, middlewares);\n    });\n    this.store.set(\"middlewares\", mdlwrs);\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  public hasChildren(): boolean {\n    return !!this.children.length;\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  public hasParent(): boolean {\n    return !!this.store.get(\"parentController\");\n  }\n\n  public getRouter<T extends PlatformRouterMethods = any>(): T {\n    return this.router as any;\n  }\n\n  public setRouter(router: PlatformRouterMethods) {\n    this.router = router;\n\n    return this;\n  }\n}\n","import {DecoratorTypes, prototypeOf, Type} from \"@tsed/core\";\nimport {getProperties, JsonEntityComponent, JsonEntityStore} from \"@tsed/schema\";\n\n@JsonEntityComponent(DecoratorTypes.PROP)\nexport class PropertyMetadata extends JsonEntityStore {\n  static get(target: Type<any>, propertyKey: string | symbol) {\n    return JsonEntityStore.from<PropertyMetadata>(prototypeOf(target), propertyKey);\n  }\n\n  /**\n   * @deprecated Since 2020-11-11. Use getProperties from @tsed/schema\n   */\n  static getProperties(target: Type<any>, options: Partial<{withIgnoredProps: boolean}> = {}) {\n    return getProperties(target, options);\n  }\n}\n","import {ControllerProvider} from \"../domain/ControllerProvider\";\n\nexport function getControllerPath(basePath: string, provider: ControllerProvider): string {\n  return (basePath === provider.path ? provider.path : (basePath || \"\") + provider.path).replace(/\\/\\//gi, \"/\");\n}\n","import {Injectable, InjectorService, ProviderScope, ProviderType, TokenProvider} from \"@tsed/di\";\nimport {ControllerProvider, EndpointMetadata, PlatformRouteDetails} from \"../domain\";\nimport {Route, RouteController} from \"../interfaces/Route\";\nimport {getControllerPath} from \"../utils/getControllerPath\";\nimport {PlatformApplication} from \"./PlatformApplication\";\n\n/**\n * `Platform` is used to provide all routes collected by annotation `@Controller`.\n *\n * @platform\n */\n@Injectable({\n  scope: ProviderScope.SINGLETON\n})\nexport class Platform {\n  #routes: PlatformRouteDetails[] = [];\n  #controllers: RouteController[] = [];\n\n  constructor(readonly injector: InjectorService, readonly platformApplication: PlatformApplication) {}\n\n  get app() {\n    return this.platformApplication;\n  }\n\n  get routes(): PlatformRouteDetails[] {\n    return this.#routes;\n  }\n\n  public addRoutes(routes: Route[]) {\n    routes.forEach((routeSettings) => {\n      this.addRoute(routeSettings.route, routeSettings.token);\n    });\n  }\n\n  public addRoute(endpoint: string, token: TokenProvider) {\n    const {injector} = this;\n\n    if (injector.hasProvider(token)) {\n      const provider: ControllerProvider = injector.getProvider(token)! as any;\n\n      if (provider.type === ProviderType.CONTROLLER) {\n        const route = getControllerPath(endpoint, provider);\n        if (!provider.hasParent()) {\n          const routes = this.buildRoutes(route, provider);\n\n          this.#routes.push(...routes);\n          this.#controllers.push({\n            route,\n            provider\n          });\n\n          this.app.use(route, ...[].concat(provider.getRouter().callback()));\n        }\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * Get all routes built by TsExpressDecorators and mounted on Express application.\n   * @returns {PlatformRouteDetails[]}\n   */\n  public getRoutes(): PlatformRouteDetails[] {\n    return this.#routes;\n  }\n\n  public getMountedControllers(): RouteController[] {\n    return this.#controllers;\n  }\n\n  /**\n   *\n   * @param ctrl\n   * @param endpointUrl\n   */\n  private buildRoutes(endpointUrl: string, ctrl: ControllerProvider): PlatformRouteDetails[] {\n    const {injector} = this;\n\n    let routes: PlatformRouteDetails[] = [];\n\n    routes = ctrl.children\n      .map((ctrl) => injector.getProvider(ctrl))\n      .reduce((routes: PlatformRouteDetails[], provider: ControllerProvider) => {\n        return routes.concat(this.buildRoutes(`${endpointUrl}${provider.path}`, provider));\n      }, routes);\n\n    ctrl.endpoints.forEach((endpoint: EndpointMetadata) => {\n      endpoint.operationPaths.forEach(({path, method}) => {\n        if (method) {\n          routes.push(\n            new PlatformRouteDetails({\n              provider: ctrl,\n              endpoint,\n              method,\n              url: `${endpointUrl}${path || \"\"}`.replace(/\\/\\//gi, \"/\")\n            })\n          );\n        }\n      });\n    });\n\n    return routes;\n  }\n}\n","import {InjectorService, Module, ProviderType} from \"@tsed/di\";\nimport {PlatformControllerBuilder} from \"./builder/PlatformControllerBuilder\";\nimport {ControllerProvider} from \"./domain/ControllerProvider\";\nimport {Route} from \"./interfaces/Route\";\nimport {ConverterService} from \"./services/ConverterService\";\nimport {Platform} from \"./services/Platform\";\nimport {PlatformRouter} from \"./services/PlatformRouter\";\n\n/**\n * @ignore\n */\n@Module({\n  imports: [InjectorService, ConverterService, Platform]\n})\nexport class PlatformModule {\n  constructor(protected injector: InjectorService, protected platform: Platform) {\n    this.createRoutersFromControllers();\n  }\n\n  /**\n   * Create routers from the collected controllers\n   */\n  public createRoutersFromControllers() {\n    const {injector} = this;\n\n    return injector\n      .getProviders(ProviderType.CONTROLLER)\n      .map((provider: ControllerProvider) => {\n        provider.setRouter(PlatformRouter.create(injector, provider.routerOptions));\n\n        if (!provider.hasParent()) {\n          return new PlatformControllerBuilder(provider as ControllerProvider).build(injector);\n        }\n      })\n      .filter(Boolean);\n  }\n\n  public $$loadRoutes() {\n    const routes = this.injector.settings.get<Route[]>(\"routes\");\n\n    this.platform.addRoutes(routes);\n  }\n}\n","import {GlobalProviders, InjectorService, setLoggerLevel} from \"@tsed/di\";\nimport {$log} from \"@tsed/logger\";\nimport {PlatformConfiguration} from \"../config/services/PlatformConfiguration\";\n\n$log.name = \"TSED\";\n\nexport function createInjector(settings: Partial<TsED.Configuration> = {}) {\n  const injector = new InjectorService();\n  injector.settings = createSettingsService(injector);\n  injector.logger = $log;\n  injector.settings.set(settings);\n\n  setLoggerLevel(injector);\n\n  return injector;\n}\n\nfunction createSettingsService(injector: InjectorService): PlatformConfiguration & TsED.Configuration {\n  const provider = GlobalProviders.get(PlatformConfiguration)!.clone();\n\n  provider.instance = injector.invoke<PlatformConfiguration>(provider.useClass);\n  injector.addProvider(PlatformConfiguration, provider);\n\n  return provider.instance as any;\n}\n","import {InjectorService} from \"@tsed/di\";\nimport {PlatformApplication} from \"../services/PlatformApplication\";\n\nexport function createPlatformApplication(injector: InjectorService): void {\n  injector.forkProvider(PlatformApplication);\n}\n","import {Type} from \"@tsed/core\";\nimport {Inject} from \"@tsed/di\";\nimport Http from \"http\";\n\n/**\n * Inject the Http.Server instance.\n *\n * ### Example\n *\n * ```typescript\n * import {HttpServer, Service} from \"@tsed/common\";\n *\n * @Service()\n * export default class OtherService {\n *    constructor(@HttpServer httpServer: HttpServer) {}\n * }\n * ```\n *\n * > Note: TypeScript transform and store `HttpServer` as `Function` type in the metadata. So to inject a factory, you must use the `@Inject(type)` decorator.\n *\n * @param {Type<any>} target\n * @param {string} targetKey\n * @param {TypedPropertyDescriptor<Function> | number} descriptor\n * @returns {any}\n * @decorator\n */\nexport function HttpServer(target: Type<any>, targetKey: string, descriptor: TypedPropertyDescriptor<Function> | number) {\n  return Inject(HttpServer)(target, targetKey, descriptor);\n}\n\nexport type HttpServer = Http.Server;\n","import Http from \"http\";\nimport Https from \"https\";\n\nexport function listenServer(\n  http: Http.Server | Https.Server,\n  settings: {address: string | number; port: number}\n): Promise<{address: string; port: number}> {\n  const {address, port} = settings;\n\n  const promise = new Promise((resolve, reject) => {\n    http.on(\"listening\", resolve);\n    http.on(\"error\", reject);\n  }).then(() => {\n    const port = (http.address() as any).port;\n\n    return {address: settings.address as string, port};\n  });\n\n  http.listen(port, address as any);\n\n  return promise;\n}\n","import {InjectorService, ProviderScope, registerProvider} from \"@tsed/di\";\nimport Http from \"http\";\nimport {PlatformApplication} from \"../services/PlatformApplication\";\nimport {HttpServer} from \"../decorators/httpServer\";\nimport {listenServer} from \"./listenServer\";\n\nexport function createHttpServer(injector: InjectorService): void {\n  injector.forkProvider(HttpServer);\n}\n\nregisterProvider({\n  provide: HttpServer,\n  deps: [PlatformApplication],\n  scope: ProviderScope.SINGLETON,\n  global: true,\n  useFactory(platformApplication: PlatformApplication) {\n    return Http.createServer(platformApplication.callback());\n  }\n});\n\nexport async function listenHttpServer(injector: InjectorService) {\n  const {settings} = injector;\n  const server = injector.get<HttpServer>(HttpServer);\n\n  if (settings.httpPort !== false && server) {\n    const {address, port} = settings.getHttpPort();\n    injector.logger.debug(`Start server on http://${address}:${port}`);\n\n    const options = await listenServer(server, {address, port});\n    settings.setHttpPort(options);\n\n    injector.logger.info(`Listen server on http://${options.address}:${options.port}`);\n  }\n}\n","import {Type} from \"@tsed/core\";\nimport {Inject} from \"@tsed/di\";\nimport Https from \"https\";\n\n/**\n * Inject the Https.Server instance.\n *\n * ### Example\n *\n * ```typescript\n * import {HttpsServer, Service} from \"@tsed/common\";\n *\n * @Service()\n * export default class OtherService {\n *    constructor(@HttpsServer httpServer: HttpServer) {}\n * }\n * ```\n *\n * > Note: TypeScript transform and store `HttpsServer` as `Function` type in the metadata. So to inject a factory, you must use the `@Inject(type)` decorator.\n *\n * @param {Type<any>} target\n * @param {string} targetKey\n * @param {TypedPropertyDescriptor<Function> | number} descriptor\n * @returns {any}\n * @decorator\n */\nexport function HttpsServer(target: Type<any>, targetKey: string, descriptor: TypedPropertyDescriptor<Function> | number) {\n  return Inject(HttpsServer)(target, targetKey, descriptor);\n}\n\nexport type HttpsServer = Https.Server;\n","import {Configuration, InjectorService, ProviderScope, registerProvider} from \"@tsed/di\";\nimport Https from \"https\";\nimport {PlatformApplication} from \"../services/PlatformApplication\";\nimport {HttpsServer} from \"../decorators/httpsServer\";\nimport {listenServer} from \"./listenServer\";\n\nexport function createHttpsServer(injector: InjectorService): void {\n  injector.forkProvider(HttpsServer);\n}\n\nregisterProvider({\n  provide: HttpsServer,\n  deps: [PlatformApplication, Configuration],\n  scope: ProviderScope.SINGLETON,\n  global: true,\n  useFactory(platformApplication: PlatformApplication, settings: Configuration) {\n    const options = settings.httpsOptions!;\n\n    return Https.createServer(options, platformApplication.callback());\n  }\n});\n\nexport async function listenHttpsServer(injector: InjectorService) {\n  const {settings} = injector;\n  const server = injector.get<HttpsServer>(HttpsServer);\n\n  if (settings.httpsPort !== false && server) {\n    const {address, port} = settings.getHttpsPort();\n    injector.logger.debug(`Start server on https://${address}:${port}`);\n\n    const options = await listenServer(server, {address, port});\n    settings.setHttpsPort(options);\n\n    injector.logger.info(`Listen server on https://${options.address}:${options.port}`);\n  }\n}\n","import {Container, createContainer, InjectorService, LocalsContainer} from \"@tsed/di\";\nimport {PlatformModule} from \"../PlatformModule\";\n\n/**\n * @ignore\n * @deprecated User injector.load(container, module) instead\n */\nexport async function loadInjector(injector: InjectorService, container: Container = createContainer()): Promise<LocalsContainer<any>> {\n  injector.bootstrap(container);\n  return injector.load(container, PlatformModule);\n}\n","import {$log, colorize} from \"@tsed/logger\";\nimport {PlatformRouteDetails} from \"../domain/PlatformRouteDetails\";\n\nexport function printRoutes(routes: PlatformRouteDetails[]) {\n  const mapColor: {[key: string]: string} = {\n    GET: \"green\",\n    POST: \"yellow\",\n    PUT: \"blue\",\n    DELETE: \"red\",\n    PATCH: \"magenta\",\n    ALL: \"cyan\"\n  };\n\n  const list = routes.map((route) => {\n    const obj = route.toJSON();\n    const method = obj.method.toUpperCase();\n\n    obj.method = {\n      length: method.length,\n      toString: () => {\n        return colorize(method, mapColor[method]);\n      }\n    } as any;\n\n    return obj;\n  });\n\n  const str = $log.drawTable(list, {\n    padding: 1,\n    header: {\n      method: \"Method\",\n      url: \"Endpoint\",\n      name: \"Class method\"\n    }\n  });\n\n  return \"\\n\" + str.trim();\n}\n","import {InjectorService} from \"@tsed/di\";\nimport {PlatformContext} from \"../domain/PlatformContext\";\nimport {PlatformRequest} from \"../services/PlatformRequest\";\nimport {PlatformResponse} from \"../services/PlatformResponse\";\nimport {IncomingEvent} from \"../interfaces/IncomingEvent\";\nimport {PlatformViews} from \"@tsed/platform-views\";\n\nconst uuidv4 = require(\"uuid\").v4;\nconst defaultReqIdBuilder = (req: any) => req.get(\"x-request-id\") || uuidv4().replace(/-/gi, \"\");\n\n/**\n * Create the TsED context to wrap request, response, injector, etc...\n * @param injector\n * @ignore\n */\nexport function createContext(injector: InjectorService) {\n  const ResponseKlass = injector.getProvider(PlatformResponse)?.useClass;\n  const RequestKlass = injector.getProvider(PlatformRequest)?.useClass;\n  const platformViews = injector.get<PlatformViews>(PlatformViews)!;\n  const {reqIdBuilder = defaultReqIdBuilder, ...loggerOptions} = injector.settings.logger;\n\n  return async (event: IncomingEvent): Promise<PlatformContext> => {\n    const ctx = new PlatformContext({\n      event,\n      id: reqIdBuilder(event.request),\n      logger: injector.logger,\n      ...loggerOptions,\n      injector,\n      ResponseKlass,\n      RequestKlass\n    });\n\n    ctx.response.platformViews = platformViews;\n\n    ctx.response.onEnd(async () => {\n      await ctx.emit(\"$onResponse\", ctx);\n      await ctx.destroy();\n    });\n\n    await ctx.emit(\"$onRequest\", ctx);\n\n    return ctx;\n  };\n}\n","import {classOf, constructorOf, nameOf, toMap, Type} from \"@tsed/core\";\nimport {Container, createContainer, getConfiguration, InjectorService, IProvider, setLoggerLevel} from \"@tsed/di\";\nimport {importProviders} from \"@tsed/components-scan\";\nimport {PerfLogger} from \"@tsed/perf\";\nimport {getMiddlewaresForHook} from \"@tsed/platform-middlewares\";\nimport {PlatformViews} from \"@tsed/platform-views\";\nimport {GlobalAcceptMimesMiddleware, PlatformLogMiddleware} from \"../middlewares\";\nimport {PlatformModule} from \"../PlatformModule\";\nimport {Platform} from \"../services/Platform\";\nimport {PlatformApplication} from \"../services/PlatformApplication\";\nimport {PlatformHandler} from \"../services/PlatformHandler\";\nimport {PlatformRequest} from \"../services/PlatformRequest\";\nimport {PlatformResponse} from \"../services/PlatformResponse\";\nimport {PlatformRouter} from \"../services/PlatformRouter\";\n\nimport {\n  createHttpServer,\n  createHttpsServer,\n  createInjector,\n  createPlatformApplication,\n  listenHttpServer,\n  listenHttpsServer,\n  printRoutes\n} from \"../utils\";\n\nconst SKIP_HOOKS = [\"$beforeInit\", \"$afterInit\", \"$onInit\", \"$onMountingMiddlewares\"];\n\n/**\n * @ignore\n */\nexport interface PlatformType<T = any> extends Type<T> {\n  providers: IProvider[];\n}\n\nconst {bind, start, end, log} = PerfLogger.get(\"bootstrap\");\n\n/**\n * @ignore\n */\nexport interface PlatformBootstrap {\n  bootstrap(module: Type<any>, settings?: Partial<TsED.Configuration>): Promise<PlatformBuilder>;\n}\n\n/**\n * @platform\n */\nexport abstract class PlatformBuilder<App = TsED.Application, Router = TsED.Router> {\n  static currentPlatform: Type<PlatformBuilder<any, any>> & PlatformBootstrap;\n  readonly name: string = \"\";\n  protected startedAt = new Date();\n  protected locals: Container;\n  #rootModule: any;\n  #injector: InjectorService;\n  #providers: Map<Type, IProvider>;\n\n  constructor({name, providers}: {name: string; providers: IProvider[]}) {\n    this.name = name;\n    this.#providers = toMap<any, IProvider>(providers, \"provide\");\n\n    this.locals = new Container();\n\n    this.useProvider(PlatformHandler, this.#providers.get(PlatformHandler))\n      .useProvider(PlatformResponse, this.#providers.get(PlatformResponse))\n      .useProvider(PlatformRequest, this.#providers.get(PlatformRequest))\n      .useProvider(PlatformRouter, this.#providers.get(PlatformRouter))\n      .useProvider(PlatformApplication, this.#providers.get(PlatformApplication))\n      .useProvider(Platform, this.#providers.get(Platform));\n  }\n\n  get injector(): InjectorService {\n    return this.#injector;\n  }\n\n  get rootModule(): any {\n    return this.#rootModule;\n  }\n\n  get app(): PlatformApplication<App, Router> {\n    return this.injector.get<PlatformApplication<App, Router>>(PlatformApplication)!;\n  }\n\n  get platform() {\n    return this.injector.get<Platform>(Platform)!;\n  }\n\n  /**\n   * Return the settings configured by the decorator @@Configuration@@.\n   *\n   * ```typescript\n   * @Configuration({\n   *    rootDir: Path.resolve(__dirname),\n   *    port: 8000,\n   *    httpsPort: 8080,\n   *    mount: {\n   *      \"/rest\": \"${rootDir}/controllers/**\\/*.js\"\n   *    }\n   * })\n   * export class Server {\n   *     $onInit(){\n   *         console.log(this.settings); // {rootDir, port, httpsPort,...}\n   *     }\n   * }\n   * ```\n   *\n   * @returns {PlatformConfiguration}\n   */\n  get settings() {\n    return this.injector.settings;\n  }\n\n  get logger() {\n    return this.injector.logger;\n  }\n\n  get disableBootstrapLog() {\n    return this.settings.logger.disableBootstrapLog;\n  }\n\n  static build<T extends PlatformBuilder<any, any>>(platformBuildClass: PlatformType<T>): T {\n    return new platformBuildClass({\n      name: nameOf(platformBuildClass).replace(\"Platform\", \"\").toLowerCase(),\n      providers: platformBuildClass.providers\n    });\n  }\n\n  log(...data: any[]) {\n    return this.disableBootstrapLog && this.logger.info(...data);\n  }\n\n  /**\n   * Add classes to the components list\n   * @param classes\n   */\n  public addComponents(classes: any | any[]) {\n    this.settings.componentsScan = this.settings.componentsScan.concat(classes);\n\n    return this;\n  }\n\n  /**\n   * Add classes decorated by @@Controller@@ to components container.\n   *\n   * ### Example\n   *\n   * ```typescript\n   * @Controller('/ctrl')\n   * class MyController{\n   * }\n   *\n   * platform.addControllers('/rest', [MyController])\n   * ```\n   *\n   * ::: tip\n   * If the MyController class isn't decorated, the class will be ignored.\n   * :::\n   *\n   * @param {string} endpoint\n   * @param {any[]} controllers\n   */\n  public addControllers(endpoint: string, controllers: any | string | (any | string)[]) {\n    this.settings.mount[endpoint] = (this.settings.mount[endpoint] || []).concat(controllers);\n  }\n\n  public async runLifecycle() {\n    setLoggerLevel(this.injector);\n\n    await this.importProviders();\n    await this.loadInjector();\n\n    this.useContext();\n    this.useRouter();\n\n    await this.loadRoutes();\n    await this.logRoutes();\n  }\n\n  async loadInjector() {\n    const {injector} = this;\n    await this.callHook(\"$beforeInit\");\n\n    this.log(\"Build providers\");\n    const container = createContainer(constructorOf(this.rootModule));\n\n    await injector.load(container, PlatformModule);\n\n    this.log(\"Settings and injector loaded\");\n\n    await this.callHook(\"$afterInit\");\n  }\n\n  async listen() {\n    await this.callHook(\"$beforeListen\");\n\n    await this.listenServers();\n\n    await this.callHook(\"$afterListen\");\n\n    await this.ready();\n    end();\n  }\n\n  async stop() {\n    await this.callHook(\"$onDestroy\");\n    return this.injector.destroy();\n  }\n\n  public async ready() {\n    const {startedAt} = this;\n\n    await this.callHook(\"$onReady\");\n    await this.injector.emit(\"$onServerReady\");\n\n    this.log(`Started in ${new Date().getTime() - startedAt.getTime()} ms`);\n  }\n\n  async callHook(hook: string, ...args: any[]) {\n    const {injector, rootModule} = this;\n    log(hook);\n\n    if (!injector.settings.logger.disableBootstrapLog) {\n      injector.logger.info(`\\x1B[1mCall hook ${hook}\\x1B[22m`);\n    }\n\n    // call hook for the Server\n    if (hook in rootModule) {\n      await rootModule[hook](...args);\n    }\n\n    // Load middlewares for the given hook\n    this.loadMiddlewaresFor(hook);\n\n    // call hooks added by providers\n    if (!SKIP_HOOKS.includes(hook)) {\n      await injector.emit(hook);\n    }\n  }\n\n  async loadStatics(): Promise<void> {\n    const {settings} = this;\n\n    if (settings.statics) {\n      Object.entries(settings.statics).forEach(([path, items]) => {\n        [].concat(items as any).forEach((options) => {\n          const opts =\n            typeof options === \"string\"\n              ? {\n                  root: options\n                }\n              : options;\n\n          this.platform.app.statics(path, opts);\n        });\n      });\n    }\n  }\n\n  useProvider(token: Type<any>, settings?: Partial<IProvider>) {\n    this.locals.addProvider(token, settings);\n\n    return this;\n  }\n\n  protected async importProviders() {\n    this.injector.logger.debug(\"Scan components\");\n\n    const providers = await importProviders(this.injector.settings, [\"imports\", \"mount\", \"componentsScan\"]);\n    const routes = providers.filter((provider) => !!provider.route).map(({route, token}) => ({route, token}));\n\n    this.settings.set(\"routes\", routes);\n  }\n\n  /**\n   * Load middlewares from configuration for the given hook\n   * @param hook\n   * @protected\n   */\n  protected loadMiddlewaresFor(hook: string): void {\n    return getMiddlewaresForHook(hook, this.settings, \"$beforeRoutesInit\").forEach(({use}) => {\n      this.app.use(use);\n    });\n  }\n\n  protected useRouter(): this {\n    return this;\n  }\n\n  protected useContext(): this {\n    return this;\n  }\n\n  protected async bootstrap(module: Type<any>, settings: Partial<TsED.Configuration> = {}) {\n    // istanbul ignore next\n    if (settings.logger?.perf) {\n      start();\n      bind(this);\n      settings.logger = {\n        ...settings.logger,\n        level: \"off\"\n      };\n    }\n\n    this.createInjector(module, {\n      ...settings,\n      PLATFORM_NAME: this.name\n    });\n    this.createRootModule(module);\n\n    await this.runLifecycle();\n\n    return this;\n  }\n\n  protected async listenServers(): Promise<void> {\n    await Promise.all([listenHttpServer(this.injector), listenHttpsServer(this.injector)]);\n  }\n\n  protected async logRoutes() {\n    const {logger, platform} = this;\n\n    if (!this.settings.logger.disableRoutesSummary && !this.disableBootstrapLog) {\n      logger.info(\"Routes mounted :\");\n      logger.info(printRoutes(await this.injector.alterAsync(\"$logRoutes\", platform.getRoutes())));\n    }\n  }\n\n  protected async loadRoutes() {\n    // istanbul ignore next\n    if (this.settings.logger.level !== \"off\") {\n      this.app.use(PlatformLogMiddleware);\n    }\n\n    if (this.settings.acceptMimes?.length) {\n      this.app.use(GlobalAcceptMimesMiddleware);\n    }\n\n    this.log(\"Load routes\");\n    await this.callHook(\"$beforeRoutesInit\");\n\n    await this.callHook(\"$$loadRoutes\");\n\n    await this.callHook(\"$onRoutesInit\");\n\n    await this.loadStatics();\n\n    await this.callHook(\"$afterRoutesInit\");\n  }\n\n  protected createInjector(module: Type<any>, settings: any) {\n    const configuration = getConfiguration(module, settings);\n\n    this.#injector = createInjector(configuration);\n\n    // configure locals providers\n    this.locals.forEach((provider) => {\n      this.injector.addProvider(provider.token, provider);\n    });\n\n    createPlatformApplication(this.injector);\n    createHttpsServer(this.injector);\n    createHttpServer(this.injector);\n  }\n\n  protected createRootModule(module: Type<any>) {\n    this.#rootModule = this.injector.invoke(module);\n\n    this.injector.delete(constructorOf(this.#rootModule));\n    this.injector.delete(classOf(this.#rootModule));\n  }\n}\n","import {StoreMerge} from \"@tsed/core\";\nimport {PlatformMulterSettings} from \"../../config/interfaces/PlatformMulterSettings\";\nimport {PlatformMulterMiddleware} from \"../../middlewares/PlatformMulterMiddleware\";\n\n/**\n * Define multer option for all MultipartFile\n *\n * ```typescript\n * import {Controller, Post, PlatformMulterFile, MultipartFile, MulterOptions} from \"@tsed/common\";\n *\n * @Controller('/')\n * class MyCtrl {\n *   @Post('/file')\n *   private uploadFile(@MultipartFile(\"file1\") file: PlatformMulterFile) {\n *\n *   }\n *\n *   @Post('/file')\n *   @MulterOptions({dest: \"/other-dir\"})\n *   private uploadFile(@MultipartFile(\"file1\") file: PlatformMulterFile) {\n *\n *   }\n *\n *   @Post('/file2')\n *   @MulterOptions({dest: \"/other-dir\"})\n *   private uploadFile(@MultipartFile(\"file1\") file: PlatformMulterFile, @MultipartFile(\"file2\") file2: PlatformMulterFile) {\n *\n *   }\n *\n *   @Post('/files')\n *   private uploadFile(@MultipartFile(\"file1\") files: PlatformMulterFile[]) {\n *\n *   }\n * }\n * ```\n *\n * See the tutorial on the [multer configuration](/tutorials/multer.md).\n *\n * @param {multer.Options} options\n * @returns {(target: any, propertyKey: string, descriptor: PropertyDescriptor) => PropertyDescriptor}\n * @decorator\n * @multer\n */\nexport function MulterOptions(options: PlatformMulterSettings): MethodDecorator {\n  return (target: any, propertyKey: string, descriptor: PropertyDescriptor) => {\n    StoreMerge(PlatformMulterMiddleware, {options})(target, propertyKey, descriptor);\n\n    return descriptor;\n  };\n}\n","import {MulterOptions} from \"./multerOptions\";\n\n/**\n * Define file size limit.\n *\n * ```typescript\n * import {Controller, Post} from \"@tsed/common\";\n * import {MulterOptions, MultipartFile} from \"@tsed/common\";\n * import {Multer} from \"@types/multer\";\n *\n * type MulterFile = Express.Multer.File;\n *\n * @Controller('/')\n * class MyCtrl {\n *   @Post('/file2')\n *   @MulterFileSize(1024) // (Ko). Applied for all fields\n *   private uploadFile(@MultipartFile(\"file1\") file: MulterFile, @MultipartFile(\"file2\") file2: MulterFile) {\n *\n *   }\n * }\n * ```\n *\n * > See the tutorial on the [multer configuration](/tutorials/multer.md).\n * @param fileSize\n * @returns {(target: any, propertyKey: string, descriptor: PropertyDescriptor) => PropertyDescriptor}\n * @decorator\n * @multer\n */\nexport function MulterFileSize(fileSize: number): MethodDecorator {\n  return MulterOptions({limits: {fileSize}});\n}\n","import {DecoratorParameters, Metadata, StoreMerge, useDecorators, useMethodDecorators} from \"@tsed/core\";\nimport {ParamTypes, UseParam} from \"@tsed/platform-params\";\nimport {Consumes, Returns} from \"@tsed/schema\";\nimport {PlatformMulterFile} from \"../../config/interfaces/PlatformMulterSettings\";\nimport {MulterInputOptions, PlatformMulterMiddleware} from \"../../middlewares/PlatformMulterMiddleware\";\n\nfunction mapOptions(name: string, maxCount: number | undefined): MulterInputOptions {\n  return {\n    fields: [\n      {\n        name,\n        maxCount\n      }\n    ]\n  };\n}\n\n/**\n * Define a parameter as Multipart file.\n *\n * ```typescript\n * import {Controller, Post} from \"@tsed/common\";\n * import {MulterOptions, MultipartFile} from \"@tsed/common\";\n * import {Multer} from \"@types/multer\";\n *\n * type MulterFile = Express.Multer.File;\n *\n * @Controller('/')\n * class MyCtrl {\n *   @Post('/file')\n *   private uploadFile(@MultipartFile(\"file1\") file: MulterFile) {\n *\n *   }\n *\n *   @Post('/file')\n *   @MulterOptions({dest: \"/other-dir\"})\n *   private uploadFile(@MultipartFile(\"file1\") file: MulterFile) {\n *\n *   }\n *\n *   @Post('/file2')\n *   @MulterOptions({dest: \"/other-dir\"})\n *   private uploadFile(@MultipartFile(\"file1\") file: MulterFile, @MultipartFile(\"file2\") file2: MulterFile) {\n *\n *   }\n *\n *   @Post('/files')\n *   private uploadFile(@MultipartFile(\"file1\") files: MulterFile[]) {\n *\n *   }\n * }\n * ```\n *\n * > See the tutorial on the [multer configuration](/tutorials/multer.md).\n *\n * @param name\n * @param maxCount\n * @returns Function\n * @decorator\n * @input\n */\nexport function MultipartFile(name: string, maxCount?: number): ParameterDecorator {\n  return (...args: DecoratorParameters): void => {\n    const [target, propertyKey, index] = args;\n    const multiple = Metadata.getParamTypes(target, propertyKey)[index as number] === Array;\n\n    name = (typeof name === \"object\" ? undefined : name)!;\n\n    const expression = [name, !multiple && \"0\"].filter(Boolean).join(\".\");\n\n    const decorators = useDecorators(\n      useMethodDecorators(\n        Returns(400).Description(\n          `<File too long | Too many parts | Too many files | Field name too long | Field value too long | Too many fields | Unexpected field>  [fieldName] Example: File too long file1`\n        ),\n        Consumes(\"multipart/form-data\"),\n        StoreMerge(PlatformMulterMiddleware, mapOptions(name, maxCount))\n      ),\n      UseParam({\n        paramType: ParamTypes.FILES,\n        dataPath: \"$ctx.request.files\",\n        expression,\n        useValidation: true\n      })\n    );\n\n    decorators(...args);\n  };\n}\n\nexport type MultipartFile = PlatformMulterFile;\n","import {Use} from \"@tsed/platform-middlewares\";\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function All(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"all\", path].concat(args));\n}\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function Get(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"get\", path].concat(args));\n}\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function Post(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"post\", path].concat(args));\n}\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function Put(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"put\", path].concat(args));\n}\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function Delete(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"delete\", path].concat(args));\n}\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function Head(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"head\", path].concat(args));\n}\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function Patch(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"patch\", path].concat(args));\n}\n\n/**\n * This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).\n *\n * This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches.\n * For example, if you placed the following route at the top of all other route definitions, it would require that\n * all routes from that point on would require authentication, and automatically load a user.\n * Keep in mind that these callbacks do not have to act as end points; loadUser can perform a task, then call next()\n * to continue matching subsequent routes.\n * @param path\n * @param args\n * @returns {Function}\n * @decorator\n * @operation\n * @httpMethod\n */\nexport function Options(path: string | RegExp | any = \"/\", ...args: any[]): Function {\n  return Use(...[\"options\", path].concat(args));\n}\n","import {DecoratorParameters} from \"@tsed/core\";\nimport {JsonEntityFn} from \"@tsed/schema\";\nimport {EndpointMetadata} from \"../../domain\";\n\n/**\n *\n * @param fn\n * @decorator\n */\nexport function EndpointFn(fn: (endpoint: EndpointMetadata, parameters: DecoratorParameters) => void): MethodDecorator {\n  return JsonEntityFn<EndpointMetadata>(fn) as any;\n}\n","import {useDecorators} from \"@tsed/core\";\nimport {Produces} from \"@tsed/schema\";\nimport {EndpointFn} from \"./endpointFn\";\n\n/**\n * Set a mime list which are acceptable and checks if the specified content types are acceptable, based on the request’s Accept HTTP header field.\n *\n * ```typescript\n *  @Controller('/mypath')\n *  export class MyCtrl {\n *\n *    @Get('/')\n *    @AcceptMime('application/json')\n *    public getResource(){}\n *  }\n * ```\n *\n * @param mimes\n * @decorator\n * @operation\n * @response\n */\nexport function AcceptMime(...mimes: string[]): Function {\n  return useDecorators(\n    Produces(...mimes),\n    EndpointFn((endpoint) => {\n      endpoint.acceptMimes = mimes;\n    })\n  );\n}\n","import {isArrayOrArrayClass, Store, Type} from \"@tsed/core\";\nimport {IProvider, registerController} from \"@tsed/di\";\nimport {PathType} from \"../../interfaces\";\n\nexport interface ControllerMiddlewares {\n  useBefore: any[];\n  use: any[];\n  useAfter: any[];\n}\n\nexport interface ControllerOptions extends Partial<IProvider<any>> {\n  path?: PathType;\n  children?: Type<any>[];\n  routerOptions?: any;\n  middlewares?: Partial<ControllerMiddlewares>;\n}\n\nfunction mapOptions(options: any): ControllerOptions {\n  if (typeof options === \"string\" || options instanceof RegExp || isArrayOrArrayClass(options)) {\n    return {\n      path: options\n    };\n  }\n\n  return options;\n}\n\n/**\n * Declare a new controller with his Rest path. His methods annotated will be collected to build the routing list.\n * This routing listing will be built with the `express.Router` object.\n *\n * ::: tip\n * See [Controllers](/docs/controllers.md) section for more details\n * :::\n *\n * ```typescript\n *  @Controller(\"/calendars\")\n *  export provide CalendarCtrl {\n *\n *    @Get(\"/:id\")\n *    public get(\n *      @Req() request: Req,\n *      @Res() response: Res,\n *      @Next() next: Next\n *    ): void {\n *\n *    }\n *  }\n * ```\n *\n * @param options\n * @controller\n * @decorator\n * @classDecorator\n */\nexport function Controller(options: PathType | ControllerOptions): ClassDecorator {\n  const {children = [], ...opts} = mapOptions(options);\n\n  return (target) => {\n    registerController({\n      provide: target,\n      ...opts\n    });\n\n    Store.from(target).set(\"childrenControllers\", children);\n\n    children.forEach((childToken) => {\n      Store.from(childToken).set(\"parentController\", target);\n    });\n  };\n}\n","import {ParamTypes} from \"@tsed/platform-params\";\nimport {UseParam} from \"@tsed/platform-params\";\n\n/**\n * Return the current response data. Prefer the @@Context@@ decorator to get or set data.\n *\n * @decorator\n * @operation\n * @input\n * @deprecated Use `@Context() $ctx: Context` then $ctx.data.\n */\nexport function ResponseData(): ParameterDecorator {\n  return UseParam({\n    paramType: ParamTypes.$CTX,\n    dataPath: \"$ctx.data\"\n  });\n}\n","import {isClass, Metadata, nameOf} from \"@tsed/core\";\nimport {ParamTypes, UseParam} from \"@tsed/platform-params\";\nimport {ServerResponse} from \"http\";\n\nfunction getParamType(target: Object, propertyKey: string | symbol, parameterIndex: number) {\n  const type = Metadata.getOwnParamTypes(target, propertyKey)[parameterIndex];\n\n  if (isClass(type)) {\n    if (nameOf(type) === \"PlatformResponse\") {\n      return {paramType: ParamTypes.PLATFORM_RESPONSE, dataPath: \"$ctx.response\"};\n    }\n\n    if (type === ServerResponse) {\n      return {paramType: ParamTypes.NODE_RESPONSE, dataPath: \"$ctx.response.res\"};\n    }\n  }\n\n  return {paramType: ParamTypes.RESPONSE, dataPath: \"$ctx.response.response\"};\n}\n\n/**\n * Response service.\n *\n * @decorator\n * @operation\n * @input\n * @response\n */\nexport function Response(): ParameterDecorator;\nexport function Response(): ParameterDecorator {\n  return Res();\n}\n\n/**\n * Request service.\n *\n * @alias Response\n * @decorator\n * @operation\n * @input\n * @response\n */\nexport function Res(): ParameterDecorator;\nexport function Res(): ParameterDecorator {\n  return (target, propertyKey, parameterIndex) => {\n    const {paramType, dataPath} = getParamType(target, propertyKey, parameterIndex);\n    UseParam({\n      paramType,\n      dataPath\n    })(target, propertyKey, parameterIndex);\n  };\n}\n\n/**\n * Response service.\n *\n * @decorator\n * @operation\n * @input\n * @response\n */\nexport interface Response extends TsED.Response {}\n\n/**\n * Response service.\n *\n * @alias Response\n * @decorator\n * @operation\n * @input\n * @response\n */\nexport interface Res extends Response {}\n","import {isClass, Metadata, nameOf, Type} from \"@tsed/core\";\nimport {IncomingMessage} from \"http\";\nimport {mapParamsOptions, ParamOptions, ParamTypes, UseParam} from \"@tsed/platform-params\";\n\nfunction getParamType(target: Object, propertyKey: string | symbol, parameterIndex: number) {\n  const type = Metadata.getOwnParamTypes(target, propertyKey)[parameterIndex];\n\n  if (isClass(type)) {\n    if (nameOf(type) === \"PlatformRequest\") {\n      return {paramType: ParamTypes.PLATFORM_REQUEST, dataPath: \"$ctx.request\"};\n    }\n\n    if (type === IncomingMessage) {\n      return {paramType: ParamTypes.NODE_REQUEST, dataPath: \"$ctx.request.req\"};\n    }\n  }\n\n  return {paramType: ParamTypes.REQUEST, dataPath: \"$ctx.request.request\"};\n}\n\n/**\n * Request service.\n *\n * @decorator\n * @operation\n * @input\n */\nexport function Request(expression: string, useType: Type<any>): ParameterDecorator;\nexport function Request(expression: string): ParameterDecorator;\nexport function Request(useType: Type<any>): ParameterDecorator;\nexport function Request(options: ParamOptions<any>): ParameterDecorator;\nexport function Request(): ParameterDecorator;\nexport function Request(...args: any[]): ParameterDecorator {\n  // @ts-ignore\n  return Req(...args);\n}\n\n/**\n * Request service.\n *\n * @alias Request\n * @decorator\n * @operation\n * @input\n */\nexport function Req(expression: string, useType: Type<any>): ParameterDecorator;\nexport function Req(expression: string): ParameterDecorator;\nexport function Req(useType: Type<any>): ParameterDecorator;\nexport function Req(options: Partial<ParamOptions>): ParameterDecorator;\nexport function Req(): ParameterDecorator;\nexport function Req(...args: any[]): ParameterDecorator {\n  const {expression, useType, useConverter = false, useValidation = false} = mapParamsOptions(args);\n\n  return (target, propertyKey, parameterIndex) => {\n    const {paramType, dataPath} = getParamType(target, propertyKey, parameterIndex);\n\n    UseParam({\n      paramType,\n      dataPath,\n      expression,\n      useType,\n      useConverter,\n      useValidation\n    })(target, propertyKey, parameterIndex);\n  };\n}\n\n/**\n * Request service.\n *\n * @decorator\n * @operation\n * @input\n */\nexport interface Request extends TsED.Request {}\n\n/**\n * Request service.\n *\n * @alias Request\n * @decorator\n * @operation\n * @input\n */\nexport interface Req extends Request {}\n","import {ParamTypes, UseParam} from \"@tsed/platform-params\";\n\n/**\n * Get the Next function (for express application and middleware).\n *\n * @decorator\n * @operation\n * @input\n */\nexport function Next(): ParameterDecorator {\n  return UseParam({\n    paramType: ParamTypes.NEXT_FN,\n    dataPath: \"next\",\n    useConverter: false,\n    useValidation: false\n  });\n}\n\ndeclare global {\n  namespace TsED {\n    export interface NextFunction extends Function {}\n  }\n}\n/**\n * Get the Next function (for express application and middleware).\n *\n * @decorator\n * @operation\n * @input\n */\nexport type Next = TsED.NextFunction;\n","import {ParamTypes, UseParam} from \"@tsed/platform-params\";\n\n/**\n * @returns {Function}\n * @decorator\n * @operation\n * @input\n */\nexport function Err(): Function {\n  return UseParam({\n    paramType: ParamTypes.ERR,\n    dataPath: \"err\",\n    useValidation: false,\n    useConverter: false\n  });\n}\n","import {ParamTypes, UseParam} from \"@tsed/platform-params\";\nimport {EndpointMetadata} from \"../../domain/EndpointMetadata\";\n\nexport type EndpointInfo = EndpointMetadata;\n\n/**\n * Get the current endpoint metadata.\n * @decorator\n * @operation\n * @input\n * @deprecated Use `@Context() $ctx: Context` then `$ctx.endpoint` instead.\n */\nexport function EndpointInfo(): Function {\n  return UseParam({\n    paramType: ParamTypes.$CTX,\n    dataPath: \"$ctx.endpoint\",\n    useConverter: false,\n    useValidation: false\n  });\n}\n","/**\n * @ignore\n */\nexport function mapReturnedResponse({use, collection, ...options}: any): any {\n  return {\n    ...options,\n    type: options.type || use,\n    collectionType: options.collectionType || collection\n  };\n}\n","import {Type} from \"@tsed/core\";\nimport {createContainer, DITest, InjectorService} from \"@tsed/di\";\nimport {PlatformBuilder, PlatformType} from \"../builder/PlatformBuilder\";\nimport {PlatformContext, PlatformContextOptions} from \"../domain/PlatformContext\";\nimport {PlatformModule} from \"../PlatformModule\";\nimport {createInjector} from \"../utils/createInjector\";\nimport {PlatformApplication} from \"./PlatformApplication\";\nimport {PlatformViews} from \"@tsed/platform-views\";\n\n/**\n * @platform\n */\nexport class PlatformTest extends DITest {\n  public static platformBuilder: Type<PlatformBuilder<any, any>>;\n\n  static async create(options: Partial<TsED.Configuration> = {}) {\n    DITest.injector = PlatformTest.createInjector(options);\n    const container = createContainer();\n\n    await DITest.injector.load(container, PlatformModule);\n  }\n\n  /**\n   * Create a new injector with the right default services\n   */\n  static createInjector(settings: any = {}): InjectorService {\n    return createInjector(DITest.configure(settings));\n  }\n\n  /**\n   * Load the server silently without listening port and configure it on test profile.\n   * @decorator\n   * @param mod\n   * @param settings\n   * @returns {Promise<void>}\n   */\n  static bootstrap(mod: any, settings: Partial<TsED.Configuration & {listen: boolean}> = {}): () => Promise<void> {\n    return async function before(): Promise<void> {\n      let instance: any;\n      const platform: PlatformType = settings.platform || PlatformTest.platformBuilder;\n\n      /* istanbul ignore next */\n      if (!platform) {\n        throw new Error(\n          \"Platform type is not specified. Have you added at least `import @tsed/platform-express` (or equivalent) on your Server.ts ?\"\n        );\n      }\n\n      // @ts-ignore\n      instance = await PlatformBuilder.build(platform).bootstrap(mod, DITest.configure(settings));\n\n      if (!settings.listen) {\n        await instance.callHook(\"$beforeListen\");\n        await instance.callHook(\"$afterListen\");\n        await instance.ready();\n      } else {\n        await instance.listen();\n      }\n\n      // used by inject method\n      DITest.injector = instance.injector;\n    };\n  }\n\n  /**\n   * It injects services into the test function where you can alter, spy on, and manipulate them.\n   *\n   * The inject function has two parameters\n   *\n   * * an array of Service dependency injection tokens,\n   * * a test function whose parameters correspond exactly to each item in the injection token array.\n   *\n   * @param targets\n   * @param func\n   */\n  static inject<T>(targets: any[], func: (...args: any[]) => Promise<T> | T): () => Promise<T> {\n    return async (): Promise<T> => {\n      if (!DITest.hasInjector()) {\n        await PlatformTest.create();\n      }\n\n      const injector: InjectorService = DITest.injector;\n      const deps = [];\n\n      for (const target of targets) {\n        deps.push(injector.has(target) ? injector.get(target) : await injector.invoke(target));\n      }\n\n      return await func(...deps);\n    };\n  }\n\n  /**\n   * Return the raw application (express or koa).\n   * Use this callback with SuperTest.\n   *\n   * ```typescript\n   * let request: SuperTest.SuperTest<SuperTest.Test>;\n   * beforeEach(PlatformTest.bootstrap(Server, {\n   *   mount: {\n   *     \"/rest\": [ProductsController]\n   *   }\n   * }));\n   * beforeEach(() => {\n   *   request = SuperTest(PlatformTest.callback());\n   * });\n   * ```\n   */\n  static callback() {\n    return DITest.injector.get<PlatformApplication>(PlatformApplication)?.callback();\n  }\n\n  static createRequest(options: any = {}): any {\n    return {\n      headers: {},\n      get(key: string) {\n        return this.headers[key.toLowerCase()];\n      },\n      accepts(mime?: string | string[]) {\n        return require(\"accepts\")(this).types([].concat(mime as never));\n      },\n      ...options\n    };\n  }\n\n  static createResponse(options: any = {}): any {\n    return {\n      headers: {},\n      locals: {},\n      statusCode: 200,\n      status(code: number) {\n        this.statusCode = code;\n        return this;\n      },\n      contentType(content: string) {\n        this.set(\"content-type\", content);\n      },\n      contentLength(content: number) {\n        this.set(\"content-length\", content);\n      },\n      redirect(status: number, path: string) {\n        this.statusCode = status;\n        this.set(\"location\", path);\n      },\n      location(path: string) {\n        this.set(\"location\", path);\n      },\n      get(key: string) {\n        return this.headers[key.toLowerCase()];\n      },\n      getHeaders() {\n        return this.headers;\n      },\n      set(key: string, value: any) {\n        this.headers[key.toLowerCase()] = value;\n        return this;\n      },\n      send(data: any) {\n        this.data = data;\n      },\n      json(data: any) {\n        this.data = data;\n      },\n      ...options\n    };\n  }\n\n  static createRequestContext(options: Partial<PlatformContextOptions & any> = {}) {\n    const event = {\n      request: options?.request?.request || options?.event?.request || PlatformTest.createRequest(),\n      response: options?.response?.response || options?.event?.response || PlatformTest.createResponse()\n    };\n\n    const ctx = new PlatformContext({\n      id: \"id\",\n      injector: DITest.injector,\n      logger: DITest.injector.logger,\n      url: \"/\",\n      ...options,\n      event\n    });\n\n    ctx.response.platformViews = PlatformTest.get<PlatformViews>(PlatformViews);\n\n    return ctx;\n  }\n}\n","import {GlobalProviders, ProviderType} from \"@tsed/di\";\nimport {ControllerProvider} from \"../domain/ControllerProvider\";\nimport {PlatformRouter} from \"../services/PlatformRouter\";\n\nGlobalProviders.createRegistry(ProviderType.CONTROLLER, ControllerProvider, {\n  onInvoke(provider: ControllerProvider, locals: any) {\n    locals.set(PlatformRouter, provider.getRouter());\n  }\n});\n"],"names":["rootDir","process","cwd","PlatformConfiguration","DIConfiguration","constructor","env","NODE_ENV","Env","DEV","httpPort","httpsPort","scopes","ProviderType","CONTROLLER","ProviderScope","SINGLETON","logger","debug","level","logRequest","jsonIndentation","PROD","errors","headerName","mount","exclude","componentsScan","version","getRaw","v","setRaw","value","port","httpsOptions","get","resolve","statics","acceptMimes","converter","options","format","$log","appenders","set","type","levels","layout","pattern","buildAddressAndPort","addressPort","address","indexOf","split","getHttpPort","PlatformConfiguration_1","setHttpPort","settings","getHttpsPort","setHttpsPort","Injectable","scope","global","bindEndpointMiddleware","endpoint","ctx","PlatformLogMiddleware","injector","requestFields","PlatformLogMiddleware_1","DEFAULT_FIELDS","$onResponse","onLogEnd","bind","use","configureRequest","onLogStart","logStart","event","info","logEnd","status","response","statusCode","data","flush","minimalRequestPicker","obj","completeRequestPicker","requestToObject","request","method","url","headers","body","query","params","reduce","acc","key","__decorate","__param","Context","Middleware","InjectorService","createFakeRawDriver","FakeRawDriver","all","patch","post","put","head","delete","AnyToPromiseWithCtx","AnyToPromise","$ctx","err","isDone","isAborted","destroy","AnyToPromiseStatus","PENDING","RESOLVED","call","cb","isCanceledResponse","getResponse","HandlerType","HandlerMetadata","RAW_FN","target","token","propertyKey","routeOptions","handler","prototype","hasNextFunction","hasParamType","ParamTypes","NEXT_FN","ERR","ERR_MIDDLEWARE","injectable","ParamMetadata","getParams","length","RAW_ERR_FN","hasErrorParam","paramType","findIndex","p","isFinal","toString","nameOf","filter","Boolean","join","EndpointMetadata","JsonEntityStore","store","Store","fromMethod","descriptor","descriptorOf","beforeMiddlewares","middlewares","afterMiddlewares","after","before","targetName","Array","from","children","values","operation","_operation","operationPaths","view","mimes","getEndpoints","operations","getOperationsStores","map","clone","classOf","prototypeOf","addOperationPath","path","ctrlValue","deepMerge","args","concat","isFunction","EndpointMetadata_1","collectionType","_type","_schema","Enumerable","JsonEntityComponent","DecoratorTypes","METHOD","isMetadata","input","createHandlerMetadata","provider","getProvider","useClass","ENDPOINT","MIDDLEWARE","mergeHeaders","specHeaders","Object","entries","item","toLowerCase","undefined","String","example","setResponseHeaders","hasStatus","getStatus","getHeadersOf","mergedHeaders","getHeaders","setHeaders","isRedirection","redirect","ConverterService","injectorService","configuration","serialize","useAlias","additionalProperties","deserialize","Configuration","shouldBeSent","Buffer","isBuffer","isBoolean","isNumber","isString","shouldBeSerialized","isStream","PlatformHandler","createHandler","createRawHandler","createCustomHandler","compileHandler","provide","CUSTOM","next","render","getResponseOptions","responseFilter","PlatformResponseFilter","transform","metadata","CTX_FN","onCtxRequest","promise","getCustomArgs","getDefaultArgs","onRequest","requestOptions","error","resolver","runInContext","state","onSuccess","er","onError","isHeadersSent","callReturnedMiddleware","middleware","getRequest","renderView","includes","PlatformParams","PLATFORM_ROUTER_OPTIONS","Symbol","for","PlatformRouter","platformHandler","rawRouter","raw","PlatformRouter_1","createRawRouter","create","routerOptions","locals","Map","invoke","callback","getRouter","handlers","mapHandlers","addRoute","multer","m","require","makePromise","name","fn","apply","Reflect","req","res","promisify","list","index","Inject","INSTANCE","PlatformApplication","rawApp","PlatformApplication_1","createRawApp","getApp","PlatformMulterMiddleware","fields","PlatformMulterMiddleware_1","storage","dest","app","getFields","code","Exception","message","field","trim","conf","maxCount","Constant","GlobalAcceptMimesMiddleware","PlatformAcceptMimesMiddleware","uniq","accepts","NotAcceptable","AcceptMimesMiddleware","useCtxHandler","formatMethod","OperationMethods","PlatformControllerBuilder","build","useBefore","buildMiddlewares","buildEndpoints","buildChildrenCtrls","endpoints","getKey","updateFinalRouteState","has","setFinalRoute","operationPath","forEach","ALL","buildEndpoint","mldwrs","useAfter","router","hasFiles","find","FILES","size","child","Error","o","PlatformRequest","secure","host","protocol","originalUrl","rawBody","cookies","session","files","getReq","mime","aborted","Scope","onFinished","PlatformResponse","getRes","setHeader","location","contentType","contentLength","getContentLength","parseInt","getContentType","attachment","filename","stream","pipe","platformViews","send","json","getBody","onEnd","PlatformResponse_1","writableEnded","writableFinished","headersSent","PlatformContext","DIContext","ignoreUrlPatterns","ResponseKlass","RequestKlass","ignoreLog","reg","match","RegExp","id","container","PlatformRouteDetails","param","RAW_BODY","methodClassName","className","parameters","toJSON","ROUTER_OPTIONS","ControllerProvider","Provider","entity","parent","assign","mdlwrs","a","b","keys","hasChildren","hasParent","setRouter","PropertyMetadata","getProperties","PROP","getControllerPath","basePath","replace","Platform","platformApplication","routes","addRoutes","routeSettings","route","hasProvider","buildRoutes","push","getRoutes","getMountedControllers","endpointUrl","ctrl","PlatformModule","platform","createRoutersFromControllers","getProviders","$$loadRoutes","Module","imports","createInjector","createSettingsService","setLoggerLevel","GlobalProviders","instance","addProvider","createPlatformApplication","forkProvider","HttpServer","targetKey","listenServer","http","Promise","reject","on","then","listen","createHttpServer","registerProvider","deps","useFactory","Http","createServer","listenHttpServer","server","HttpsServer","createHttpsServer","Https","listenHttpsServer","loadInjector","createContainer","bootstrap","load","printRoutes","mapColor","GET","POST","PUT","DELETE","PATCH","toUpperCase","colorize","str","drawTable","padding","header","uuidv4","v4","defaultReqIdBuilder","createContext","PlatformViews","reqIdBuilder","loggerOptions","emit","SKIP_HOOKS","start","end","log","PerfLogger","PlatformBuilder","providers","Date","toMap","Container","useProvider","rootModule","disableBootstrapLog","platformBuildClass","addComponents","classes","addControllers","controllers","runLifecycle","importProviders","useContext","useRouter","loadRoutes","logRoutes","callHook","constructorOf","listenServers","ready","stop","startedAt","getTime","hook","loadMiddlewaresFor","loadStatics","items","opts","root","getMiddlewaresForHook","module","perf","PLATFORM_NAME","createRootModule","disableRoutesSummary","alterAsync","getConfiguration","MulterOptions","StoreMerge","MulterFileSize","fileSize","limits","mapOptions","MultipartFile","multiple","Metadata","getParamTypes","expression","decorators","useDecorators","useMethodDecorators","Returns","Description","Consumes","UseParam","dataPath","useValidation","All","Use","Get","Post","Put","Delete","Head","Patch","Options","EndpointFn","JsonEntityFn","AcceptMime","Produces","isArrayOrArrayClass","Controller","registerController","childToken","ResponseData","$CTX","getParamType","parameterIndex","getOwnParamTypes","isClass","PLATFORM_RESPONSE","ServerResponse","NODE_RESPONSE","RESPONSE","Response","Res","PLATFORM_REQUEST","IncomingMessage","NODE_REQUEST","REQUEST","Request","Req","useType","useConverter","mapParamsOptions","Next","Err","EndpointInfo","mapReturnedResponse","collection","PlatformTest","DITest","configure","mod","platformBuilder","inject","targets","func","hasInjector","createRequest","types","createResponse","content","createRequestContext","createRegistry","onInvoke"],"mappings":"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"}